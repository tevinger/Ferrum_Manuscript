---
title: "Upstream and Seep Chemistry"
output: html_document
date: "2025-04-08"
editor_options: 
  chunk_output_type: console
---

# Load Packages
```{r}
library(tidyverse)
library(cowplot)
library(ggplot2)
library(lubridate)
library(emmeans)
library(lme4)
library(ggeasy)
library(lattice)
library(rstatix)
library(ggsignif)
library(outliers)
library(ggpmisc)
library(ggpubr)
library(r2symbols)
library(stargazer)
library(ggbreak)
library(writexl)
library(ggrepel)
library(stringr)
library(ggthemes)
library(reshape)
library(RColorBrewer)
library(readxl)
library(dplyr)
library(gridExtra)
library(scales)
library(dbscan)
library(mclust)
library(devtools)
library(factoextra)
library(corrplot)
library(ggbiplot)
library(ggcorrplot)
library(GGally)
library(Hmisc)
library(ggbiplot)
library(ggfortify)
library(emmeans)
library(lme4)
library(lmerTest)
library(multcomp)
library(readxl)
library(learnr)
library(scatterplot3d)
library(vegan)
library(ggtern)
library(plotrix)
library(smwrBase)
library(smwrData)
library(smwrGraphs)
library(colorBlindness)
library(flextable)
library(officer)
library(dunn.test)
library(multcompView)
library(patchwork)
library(ggbreak)
library(ggpattern) 
library(plotly)
library(htmlwidgets)
library(hydrogeo)
```

# Load Data
```{r}
# Use this if it's been previously loaded 
#working_Ferrum_data <- final_working_Ferrum_Manuscript_df

#view(working_Ferrum_data)

Alaska_DataRelease_2022_2023_Ferrum_V10 <- read_excel("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Datasheets/Ferrum Manuscript Datasheets/Alaska_DataRelease_2022_2023_Ferrum_V10.xlsx")

Alaska_DataRelease_2022_2023_Ferrum_V11_molar <- read_excel("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Datasheets/Ferrum Manuscript Datasheets/Alaska_DataRelease_2022_2023_Ferrum_V11_molar.xlsx")
```

```{r}
working_Ferrum_data <- Alaska_DataRelease_2022_2023_Ferrum_V10 %>%
  dplyr::select(ParkID,
                Watershed,
                #Subcatchment,
                New_Groups,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season,
                Watershed_Area,
                Relative_MS_Watershed_Area,
                SamplingEventID,
                VisualDescription,
                Site_Classification,
                Hyd_Classification,
                Distance_km,
                Elevation_ft,
                pH,
                Temp_deg_celsius,
                Diss_oxy_mg_per_l,
                Diss_oxy_percent_sat,
                Spec_Cond_microS_per_cm,
                DIC_mgC_per_l,
                HCO3_mg_per_l,
                Alk_mgCaCO3_per_l,
                DOC_mgC_per_l,
                f_Cl_mg_per_l,
                f_NO3_mgN_per_l,
                f_SO4_mg_per_l,
                f_Ca_mg_l,
                f_Mg_mg_l,
                f_Na_mg_l,
                f_K_mg_l,
                f_SiO2_mg_per_l,
                f_Pb_mcg_per_l, p_Pb_mcg_per_l,
                f_Ag_mcg_per_l, p_Ag_mcg_per_l,
f_Al_mcg_per_l, p_Al_mcg_per_l,
f_As_mcg_per_l, p_As_mcg_per_l,
f_Ba_mcg_per_l, p_Ba_mcg_per_l,
#f_Be_mcg_per_l, p_Be_mcg_per_l,
f_Cd_mcg_per_l, p_Cd_mcg_per_l,
f_Ce_mcg_per_l, p_Ce_mcg_per_l,
f_Co_mcg_per_l, p_Co_mcg_per_l,
f_Cr_mcg_per_l, p_Cr_mcg_per_l,
f_Cu_mcg_per_l, p_Cu_mcg_per_l,
f_Dy_mcg_per_l, p_Dy_mcg_per_l,
f_Fe_mcg_per_l, p_Fe_mcg_per_l,
f_La_mcg_per_l, p_La_mcg_per_l,
f_Mn_mcg_per_l, p_Mn_mcg_per_l,
f_Nd_mcg_per_l, p_Nd_mcg_per_l,
f_Ni_mcg_per_l, p_Ni_mcg_per_l,
f_Pr_mcg_per_l, p_Pr_mcg_per_l,
f_Se_mcg_per_l, p_Se_mcg_per_l,
#f_Th_mcg_per_l, p_Th_mcg_per_l,
f_Tl_mcg_per_l, p_Tl_mcg_per_l,
f_U_mcg_per_l, p_U_mcg_per_l,
f_V_mcg_per_l, p_V_mcg_per_l,
f_Y_mcg_per_l, p_Y_mcg_per_l,
f_Zn_mcg_per_l, p_Zn_mcg_per_l,
f_REE, p_REE,
u_Pb_mcg_per_l,
u_Ag_mcg_per_l,
u_Al_mcg_per_l,
u_As_mcg_per_l,
u_Ba_mcg_per_l,
# u_Be_mcg_per_l,
u_Cd_mcg_per_l,
u_Ce_mcg_per_l,
u_Co_mcg_per_l,
u_Cr_mcg_per_l,
u_Cu_mcg_per_l,
u_Dy_mcg_per_l,
u_Fe_mcg_per_l,
u_La_mcg_per_l,
u_Mn_mcg_per_l,
u_Nd_mcg_per_l,
u_Ni_mcg_per_l,
u_Pr_mcg_per_l,
u_Se_mcg_per_l,
# u_Th_mcg_per_l,
u_Tl_mcg_per_l,
u_U_mcg_per_l,
u_V_mcg_per_l,
u_Y_mcg_per_l,
u_Zn_mcg_per_l)

unique(working_Ferrum_data$Watershed)
```

```{r}
working_Ferrum_data_molar <- Alaska_DataRelease_2022_2023_Ferrum_V11_molar %>%
  dplyr::select(ParkID,
                Watershed,
                #Subcatchment,
                New_Groups,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season,
                Watershed_Area,
                Relative_MS_Watershed_Area,
                SamplingEventID,
                VisualDescription,
                Site_Classification,
                Hyd_Classification,
                Distance_km,
                Elevation_ft,
               `H+_mol_L`,
  Temp_deg_celsius,
  Diss_oxy_mol_L,
  Spec_Cond_microS_per_cm,
  DIC_mol_L,
  HCO3_mol_L,
  Alk_mol_L,
  DOC_mol_L,
  f_Cl_mol_L,
  f_SO4_mol_L,
  f_K_mol_L,
  f_Ca_mol_L,
  f_Mg_mol_L,
  f_Na_mol_L,
  f_SiO2_mol_L,
  f_Al_mol_L,
  u_Al_mol_L,
  p_Al_mol_L,
  f_V_mol_L,
  u_V_mol_L,
  p_V_mol_L,
  f_Cr_mol_L,
  u_Cr_mol_L,
  p_Cr_mol_L,
  f_Mn_mol_L,
  u_Mn_mol_L,
  p_Mn_mol_L,
  f_Fe_mol_L,
  u_Fe_mol_L,
  p_Fe_mol_L,
  f_Co_mol_L,
  u_Co_mol_L,
  p_Co_mol_L,
  f_Ni_mol_L,
  u_Ni_mol_L,
  p_Ni_mol_L,
  f_Cu_mol_L,
  u_Cu_mol_L,
  p_Cu_mol_L,
  f_Zn_mol_L,
  u_Zn_mol_L,
  p_Zn_mol_L,
  f_As_mol_L,
  u_As_mol_L,
  p_As_mol_L,
  f_Se_mol_L,
  u_Se_mol_L,
  p_Se_mol_L,
  f_Y_mol_L,
  u_Y_mol_L,
  p_Y_mol_L,
  f_Ag_mol_L,
  u_Ag_mol_L,
  p_Ag_mol_L,
  f_Cd_mol_L,
  u_Cd_mol_L,
  p_Cd_mol_L,
  f_Ba_mol_L,
  u_Ba_mol_L,
  p_Ba_mol_L,
  f_La_mol_L,
  u_La_mol_L,
  p_La_mol_L,
  f_Ce_mol_L,
  u_Ce_mol_L,
  p_Ce_mol_L,
  f_Pr_mol_L,
  u_Pr_mol_L,
  p_Pr_mol_L,
  f_Nd_mol_L,
  u_Nd_mol_L,
  p_Nd_mol_L,
  f_Dy_mol_L,
  u_Dy_mol_L,
  p_Dy_mol_L,
  f_Tl_mol_L,
  u_Tl_mol_L,
  p_Tl_mol_L,
  f_U_mol_L,
  u_U_mol_L,
  p_U_mol_L,
  f_Pb_mol_L,
  u_Pb_mol_L,
  p_Pb_mol_L,
  f_REE, p_REE) %>%
  filter(!(is.na(New_Grouping)))

working_Ferrum_data_molar <- working_Ferrum_data_molar %>%
  mutate(across(17:104, as.numeric))

#view(working_Ferrum_data_molar)

unique(working_Ferrum_data_molar$Watershed)
```

## Molar and equivalence calculations
```{r}
# add molar ratio calculations to df
working_Ferrum_data_molar <- working_Ferrum_data_molar %>%
  mutate(Ca_Mg_ratio = f_Ca_mol_L / f_Mg_mol_L,
         Na_Cl_ratio = f_Na_mol_L / f_Cl_mol_L,
         Ca_SO4_ratio = f_Ca_mol_L / f_SO4_mol_L,
         Ca_SO4_percent = Ca_SO4_ratio * 100) 

view(working_Ferrum_data_molar)

# add columns for meq/L units for cations and anions
working_Ferrum_data <- working_Ferrum_data %>%
  mutate(
    Ca_meq_L = f_Ca_mg_l / 20.04,      # Ca²⁺: 2 eq/mol, 40.08 g/mol
    Mg_meq_L = f_Mg_mg_l / 12.155,     # Mg²⁺: 2 eq/mol, 24.31 g/mol
    Na_meq_L = f_Na_mg_l / 23,     # Na1+: 1 eq/mol, 23 g/mol
    K_meq_L = f_K_mg_l / 39.1,     # K1+: 1 eq/mol, 39.1 g/mol
    HCO3_meq_L = HCO3_mg_per_l / 61.02,  # HCO₃⁻: 1 eq/mol, 61.02 g/mol
    SO4_meq_L = f_SO4_mg_per_l / 48.03,    # SO₄²⁻: 2 eq/mol, 96.06 g/mol

    cation_sum = Ca_meq_L + Mg_meq_L,
    anion_sum = HCO3_meq_L + SO4_meq_L,

    cation_anion_ratio = cation_sum / anion_sum
  )
```

## Individual dataframes
```{r}
no_seep_df <- working_Ferrum_data %>%
  filter(New_Grouping != "Seep")

no_seep_df_molar <- working_Ferrum_data_molar %>%
  filter(New_Grouping != "Seep")

Upstream_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Upstream")

Impaired_trib_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Impaired Tributary")

#view(Upstream_df)

Downstream_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Downstream MS")

#view(Downstream_df)

Seep_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Seep")

#view(Seep_df)

Seep_control_df <- working_Ferrum_data %>%
  filter(Field_label %in% c("TukC_Seep2_con", "TukC_seep_con"))

#view(Seep_control_df)
```

#1. Summary Stats
##1.1 Summary Stats Loop
```{r}
# order for columns
column_order <- c(
  "pH_Mean", "pH_SD", "pH_Count",
  "Temp_Mean", "Temp_SD", "Temp_Count",
  "Diss_oxy_Mean", "Diss_oxy_SD", "Diss_oxy_Count",
  "Diss_oxy_percent_sat_Mean", "Diss_oxy_percent_sat_SD", "Diss_oxy_percent_sat_Count",
  "Spec_Cond_Mean", "Spec_Cond_SD", "Spec_Cond_Count",
  "DIC_Mean", "DIC_SD", "DIC_Count",
  "Alk_Mean", "Alk_SD", "Alk_Count",
  "DOC_Mean", "DOC_SD", "DOC_Count",
  "TOC_mgC_per_l_Mean", "TOC_mgC_per_l_SD", "TOC_mgC_per_l_Count",
  "f_NH3_mgN_per_l_Mean", "f_NH3_mgN_per_l_SD", "f_NH3_mgN_per_l_Count",
  "f_PO4_mgP_per_l_Mean", "f_PO4_mgP_per_l_SD", "f_PO4_mgP_per_l_Count",
  "TDN_mgN_per_l_Mean", "TDN_mgN_per_l_SD", "TDN_mgN_per_l_Count",
  "TDP_mgP_per_l_Mean", "TDP_mgP_per_l_SD", "TDP_mgP_per_l_Count",
  "f_Cl_Mean", "f_Cl_SD", "f_Cl_Count",
  "f_NO3_Mean", "f_NO3_SD", "f_NO3_Count",
  "f_SO4_Mean", "f_SO4_SD", "f_SO4_Count",
  "f_Ca_Mean", "f_Ca_SD", "f_Ca_Count",
  "f_Mg_Mean", "f_Mg_SD", "f_Mg_Count",
  "f_Na_Mean", "f_Na_SD", "f_Na_Count",
  "f_K_Mean", "f_K_SD", "f_K_Count",
  #"f_206Pb_Mean", "f_206Pb_SD", "f_206Pb_Count",
  #"f_207Pb_Mean", "f_207Pb_SD", "f_207Pb_Count",
  #"f_208Pb_Mean", "f_208Pb_SD", "f_208Pb_Count",
  "f_Pb_Mean", "f_Pb_SD", "f_Pb_Count",
  "p_Pb_Mean", "p_Pb_SD", "p_Pb_Count",
  "f_Al_Mean", "f_Al_SD", "f_Al_Count",
  "p_Al_Mean", "p_Al_SD", "p_Al_Count",
  "f_As_Mean", "f_As_SD", "f_As_Count",
  "p_As_Mean", "p_As_SD", "p_As_Count",
  "f_Ba_Mean", "f_Ba_SD", "f_Ba_Count",
  "f_Be_Mean", "f_Be_SD", "f_Be_Count",
  "p_Be_Mean", "p_Be_SD", "p_Be_Count",
  #"f_Br_Mean", "f_Br_SD", "f_Br_Count",
  "f_Cd_Mean", "f_Cd_SD", "f_Cd_Count",
  "p_Cd_Mean", "p_Cd_SD", "p_Cd_Count",
  "f_Ce_Mean", "f_Ce_SD", "f_Ce_Count",
  "p_Ce_Mean", "p_Ce_SD", "p_Ce_Count",
  "f_Co_Mean", "f_Co_SD", "f_Co_Count",
  "p_Co_Mean", "p_Co_SD", "p_Co_Count",
  "f_Cr_Mean", "f_Cr_SD", "f_Cr_Count",
  "p_Cr_Mean", "p_Cr_SD", "p_Cr_Count",
  "f_Cu_Mean", "f_Cu_SD", "f_Cu_Count",
  "p_Cu_Mean", "p_Cu_SD", "p_Cu_Count",
  "f_Dy_Mean", "f_Dy_SD", "f_Dy_Count",
  "p_Dy_Mean", "p_Dy_SD", "p_Dy_Count",
  "f_Fe_Mean", "f_Fe_SD", "f_Fe_Count",
  "p_Fe_Mean", "p_Fe_SD", "p_Fe_Count",
  "f_La_Mean", "f_La_SD", "f_La_Count",
  "p_La_Mean", "p_La_SD", "p_La_Count",
  "f_Mn_Mean", "f_Mn_SD", "f_Mn_Count",
  "p_Mn_Mean", "p_Mn_SD", "p_Mn_Count",
  "f_Nd_Mean", "f_Nd_SD", "f_Nd_Count",
  "p_Nd_Mean", "p_Nd_SD", "p_Nd_Count",
  "f_Ni_Mean", "f_Ni_SD", "f_Ni_Count",
  "p_Ni_Mean", "p_Ni_SD", "p_Ni_Count",
  "f_Pr_Mean", "f_Pr_SD", "f_Pr_Count",
  "p_Pr_Mean", "p_Pr_SD", "p_Pr_Count",
  "f_Se_Mean", "f_Se_SD", "f_Se_Count",
  "p_Se_Mean", "p_Se_SD", "p_Se_Count",
  #"f_Th_Mean", "f_Th_SD", "f_Th_Count",
  "f_Tl_Mean", "f_Tl_SD", "f_Tl_Count",
  "p_Tl_Mean", "p_Tl_SD", "p_Tl_Count",
  "f_U_Mean", "f_U_SD", "f_U_Count",
  "p_U_Mean", "p_U_SD", "p_U_Count",
  "f_V_Mean", "f_V_SD", "f_V_Count",
  "f_Y_Mean", "f_Y_SD", "f_Y_Count",
  "p_Y_Mean", "p_Y_SD", "p_Y_Count",
  "f_Zn_Mean", "f_Zn_SD", "f_Zn_Count",
  "p_Zn_Mean", "p_Zn_SD", "p_Zn_Count",
  "f_SiO2_Mean", "f_SiO2_SD", "f_SiO2_Count"
  #,"f_sum_REE_Mean", "f_sum_REE_SD", "f_sum_REE_Count",
  #"p_sum_REE_Mean", "p_sum_REE_SD", "p_sum_REE_Count"
)

```

```{r}
elements <- c("pH",
  "Temp_deg_celsius",
  "Diss_oxy_mg_per_l",
  "Diss_oxy_percent_sat",
  "Spec_Cond_microS_per_cm",
  "DIC_mgC_per_l",
  "Alk_mgCaCO3_per_l",
  "DOC_mgC_per_l",
  "TOC_mgC_per_l",
  "f_NH3_mgN_per_l",
  "f_PO4_mgP_per_l",
  "TDN_mgN_per_l",
  "TDP_mgP_per_l",
  "f_Cl_mg_per_l",
  "f_NO3_mgN_per_l",
  "f_SO4_mg_per_l",
  "f_Ca_mg_l",
  "f_Mg_mg_l",
  "f_Na_mg_l",
  "f_K_mg_l",
  "f_Al_mcg_per_l",	
  "p_Al_mcg_per_l",	
  "f_As_mcg_per_l",	
  "p_As_mcg_per_l",	
  "f_Ba_mcg_per_l",
  "p_Ba_mcg_per_l",
  "f_Cd_mcg_per_l",	
  "p_Cd_mcg_per_l",	
  "f_Ce_mcg_per_l",
  "p_Ce_mcg_per_l",	
  "f_Co_mcg_per_l",	
  "p_Co_mcg_per_l",	
  "f_Cr_mcg_per_l",	
  "p_Cr_mcg_per_l",	
  "f_Cu_mcg_per_l",	
  "p_Cu_mcg_per_l",	
  "f_Fe_mcg_per_l",	
  "p_Fe_mcg_per_l",	
  "f_Mn_mcg_per_l",	
  "p_Mn_mcg_per_l",
  "f_Ni_mcg_per_l",
  "p_Ni_mcg_per_l",
  "f_Se_mcg_per_l",
  "p_Se_mcg_per_l",
  "f_Zn_mcg_per_l",
  "p_Zn_mcg_per_l",
  "f_Y_mcg_per_l",
  "p_Y_mcg_per_l",
  "f_La_mcg_per_l",
  "p_La_mcg_per_l",
  "f_Dy_mcg_per_l",
  "p_Dy_mcg_per_l",
  "f_Nd_mcg_per_l",
  "p_Nd_mcg_per_l",
  "f_Pr_mcg_per_l",
  "p_Pr_mcg_per_l",
  "f_Tl_mcg_per_l",
  "p_Tl_mcg_per_l",
  "f_U_mcg_per_l",
  "p_U_mcg_per_l",
  "f_Pb_mcg_per_l",
  "p_Pb_mcg_per_l",
  "f_SiO2_mg_per_l")

columns <-c("pH",
  "Temp_deg_celsius",
  "Diss_oxy_mg_per_l",
  "Diss_oxy_percent_sat",
  "Spec_Cond_microS_per_cm",
  "DIC_mgC_per_l",
  "Alk_mgCaCO3_per_l",
  "DOC_mgC_per_l",
  "TOC_mgC_per_l",
  "f_NH3_mgN_per_l",
  "f_PO4_mgP_per_l",
  "TDN_mgN_per_l",
  "TDP_mgP_per_l",
  "f_Cl_mg_per_l",
  "f_NO3_mgN_per_l",
  "f_SO4_mg_per_l",
  "f_Ca_mg_l",
  "f_Mg_mg_l",
  "f_Na_mg_l",
  "f_K_mg_l",
  "f_Al_mcg_per_l",	
  "p_Al_mcg_per_l",	
  "f_As_mcg_per_l",	
  "p_As_mcg_per_l",	
  "f_Ba_mcg_per_l",
  "p_Ba_mcg_per_l",
  "f_Cd_mcg_per_l",	
  "p_Cd_mcg_per_l",	
  "f_Ce_mcg_per_l",
  "p_Ce_mcg_per_l",	
  "f_Co_mcg_per_l",	
  "p_Co_mcg_per_l",	
  "f_Cr_mcg_per_l",	
  "p_Cr_mcg_per_l",	
  "f_Cu_mcg_per_l",	
  "p_Cu_mcg_per_l",	
  "f_Fe_mcg_per_l",	
  "p_Fe_mcg_per_l",	
  "f_Mn_mcg_per_l",	
  "p_Mn_mcg_per_l",
  "f_Ni_mcg_per_l",
  "p_Ni_mcg_per_l",
  "f_Se_mcg_per_l",
  "p_Se_mcg_per_l",
  "f_Zn_mcg_per_l",
  "p_Zn_mcg_per_l",
  "f_Y_mcg_per_l",
  "p_Y_mcg_per_l",
  "f_La_mcg_per_l",
  "p_La_mcg_per_l",
  "f_Dy_mcg_per_l",
  "p_Dy_mcg_per_l",
  "f_Nd_mcg_per_l",
  "p_Nd_mcg_per_l",
  "f_Pr_mcg_per_l",
  "p_Pr_mcg_per_l",
  "f_Tl_mcg_per_l",
  "p_Tl_mcg_per_l",
  "f_U_mcg_per_l",
  "p_U_mcg_per_l",
  "f_Pb_mcg_per_l",
  "p_Pb_mcg_per_l",
  "f_SiO2_mg_per_l")
```

```{r}
# Initialize an empty list to store results
summary_stats_list <- list()

# Loop through elements and columns
for (i in seq_along(elements)) {
  element <- elements[i]
  column <- columns[i]
  
  # Perform the summary operation for the current element
  summary_stats <- working_Ferrum_data %>%
    filter(!is.na(.data[[column]])) %>%
    group_by(New_Grouping) %>% #This is where you can change what variable you want to group the data by
    summarise(
      Variable = element,
      Mean = round(mean(.data[[column]], na.rm = TRUE), 5),  
      SD = round(sd(.data[[column]], na.rm = TRUE), 5),
      Min = round(min(.data[[column]], na.rm = TRUE), 5),
      Max = round(max(.data[[column]], na.rm = TRUE), 5),
      Count = n(),
      SE = round(SD / sqrt(Count), 5),
    )
  
  # Store the result in the list with the element name as key
  summary_stats_list[[element]] <- summary_stats
}

# Combine all individual data frames into one
summary_stats_results <- do.call(rbind, summary_stats_list)

view(summary_stats_results)

#write_xlsx(summary_stats_results, "C:/Users/tevinger/OneDrive - University of California, Davis/Lab/Ferrum Figures/Grouped Summary Stats.xlsx")

write_xlsx(summary_stats_results, "C:/Users/tevinger/Downloads/Summary Stats for Site Groups.xlsx")
```

```{r}
# Reshape to wide format
summary_stats_wide <- summary_stats_results %>%
  pivot_wider(
    id_cols = c(Site_Group),           # Keep Site_Group fixed - so this would be whatever variable you added for grouping your data by
    names_from = Variable,             # Create new columns from Variable values
    values_from = c(Mean, SD, Min, Max, Count),  # Use these columns as values
    names_glue = "{Variable}_{.value}"  # Format column names like Variable_Mean, Variable_SD, etc.
  )

# This reorders the columns according to a column order I set in the list called column_order
summary_stats_wide <-  summary_stats_wide %>%
  dplyr::select(Site_Group, all_of(column_order))

# View the result
view(summary_stats_wide)
```

##1.2 By Watershed
```{r}
library(dplyr)

# Initialize an empty list to store results
summary_stats_list <- list()

# Loop through elements and columns
for (i in seq_along(elements)) {
  element <- elements[i]
  column <- columns[i]
  
  # Perform the summary operation for the current element
  summary_stats <- working_Ferrum_data %>%
    filter(!is.na(.data[[column]])) %>%
    group_by(New_Grouping, Watershed) %>%
    summarise(
      Variable = element,
      Mean = round(mean(.data[[column]], na.rm = TRUE), 5),  
      SD = round(sd(.data[[column]], na.rm = TRUE), 5),
      Min = round(min(.data[[column]], na.rm = TRUE), 5),
      Max = round(max(.data[[column]], na.rm = TRUE), 5),     
      Count = n(),
      SE = round(SD / sqrt(Count), 5),
      .groups = "drop"  # Ensure ungrouped result after summarization
    )
  
  # Store the result in the list with the element name as key
  summary_stats_list[[element]] <- summary_stats
}

# Combine all individual data frames into one
summary_stats_results <- do.call(rbind, summary_stats_list)

# View the combined summary results
view(summary_stats_results)

# Group long formatted results by Watershed
summary_stats_results <- summary_stats_results %>%
  arrange(New_Grouping)

write_xlsx(summary_stats_results, "C:/Users/tevinger/Downloads/Summary stats of site groups by watershed.xlsx")

summary_stats_results_upstream <- summary_stats_results %>%
  filter(New_Grouping == "Upstream")

write_xlsx(summary_stats_results_upstream, "C:/Users/tevinger/Downloads/Upstream Summary Stats by watershed.xlsx")
```

```{r}
#Create a df for each Watershed
Agashashok_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Agashashok River")

Nakolikurok_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Nakolikurok")

Tukpahlearik_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Tukpahlearik")

Salmon_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Salmon River")

Kugururok_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Kugururok River")

Anaktok_summary_stats <- summary_stats_results %>%
  dplyr::filter(Watershed == "Anaktok River")

write_xlsx(Agashashok_summary_stats, "C:/Users/tayta/Downloads/Agashashok Summary Stats.xlsx")
write_xlsx(Nakolikurok_summary_stats, "C:/Users/tayta/Downloads/Nakolikurok Summary Stats.xlsx")
write_xlsx(Tukpahlearik_summary_stats, "C:/Users/tayta/Downloads/Tukpahlearik Summary Stats.xlsx")
write_xlsx(Salmon_summary_stats, "C:/Users/tayta/Downloads/Salmon Summary Stats.xlsx")
write_xlsx(Kugururok_summary_stats, "C:/Users/tayta/Downloads/Kugururok Summary Stats.xlsx")
write_xlsx(Anaktok_summary_stats, "C:/Users/tayta/Downloads/Anaktok Summary Stats.xlsx")
```



#2. Data Analysis
##2.1  

##2.2 Colors
```{r}
watershed_colors <- c(  
    "Agashashok River" = "#A1E3F9",   
    "Anaktok River" = "#9F8383",
    "Salmon River Watershed" = "#9F8383",
    "Salmon River" = "#2DAA9E",   
    "Kugururok River" = "#2D3D85",  
    "Nakolikurok Creek" = "#F87FC7",
    "Nakolikurok" = "#F87FC7",
    "Tukpahlearik Creek" = "#FDDE74",
    "Tukpahlearik" = "#FDDE74"
    )

group_colors <- c(
   "Unimpaired Tributary" = "#00589b",
  "Upstream" = "#72D9FF",
  "Seep" = "#c81600",
  "Impaired Tributary" = "indianred2",
  "Downstream MS" = "#f5a678")
```

``` {r}
cb_palette_20 <- c(
  "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2",
  "#D55E00", "#CC79A7", "#999999", "#000000", "#E41A1C",
  "#377EB8", "#4DAF4A", "#984EA3", "#FF7F00", "#A65628",
  "#F781BF", "#999999", "#66C2A5", "#FC8D62", "#8DA0CB"
)
```

##2.3 Boxplots
###2.3.1 pH
```{r}
library(ggplot2)

pH_plot <- ggplot() + 
  
  # Boxplot and jitter for df_1
  geom_boxplot(data = Upstream_df, aes(x = factor(Site_Grouping), y = pH, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Upstream_df, aes(x = factor(Site_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for seep_df
  geom_boxplot(data = seep_df, aes(x = factor(Site_Grouping), y = pH, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = seep_df, aes(x = factor(Site_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  # Boxplot and jitter for df_3
  geom_boxplot(data = Seep_control_df, aes(x = factor(Site_Grouping), y = pH, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Seep_control_df, aes(x = factor(Site_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Manual fill colors for Site Group (Boxplots)
  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  # Labels
  labs(
    title = "Comparison of pH by Proximity to Seeps",
    x = "Site Group",
    y = "pH"
  ) +
  scale_y_continuous(
    breaks = c(3,4,5,6,7,8)) +
  # Theme settings
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),  
    plot.title = element_blank(),  
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_text(size = 24, color = "black", face = "bold", margin = margin(r = 10)),
    legend.position = "none",
    panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
    panel.background = element_rect(fill = "transparent"),  
    plot.background = element_rect(fill = "transparent", color = NA),
    #panel.grid.minor.y = element_line(color = "black", linewidth = 0.4, linetype = "dotted"),
    axis.ticks.y = element_line(size = 0.8, color = "black"),  # Thicker y-axis ticks
    axis.ticks.length.y = unit(0.15, "cm"),  # Longer tick marks
      axis.ticks.x = element_line(size = 0.8, color = "black"),  # Make x-axis ticks visible
      axis.ticks.length = unit(5, "pt")  # Adjust tick length (optional)
  ) 

pH_plot

ggsave("C:/Users/tayta/Downloads/pH_V2.png", pH_plot, bg = "transparent", width = 3, height = 5, dpi = 300)
```

## 2.4 Bar plot Theme
### Plot theme
```{r}
barplot_theme <- theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", linewidth = 1),
  # X and Y axis tick labels
  axis.text.x = element_text(size = 8, color = "black", face = "bold" 
                             #angle = 45, 
                             #hjust = 1
                             ),
  axis.text.y = element_text(size = 18, color = "black", face = "bold"),
  
  # X and Y axis titles
  axis.title.x = element_blank(),
  axis.title.y = element_text(
    size = 14, color = "black", face = "bold",
    margin = margin(r = 15)  # add space to the right of the y-axis title
  ),
  legend.position = "top",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 9, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", size = 0.75),
  axis.ticks.y = element_line(size = 0.8, color = "black"),  # Thicker y-axis ticks
    axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
)
```

### Plot and metal colors
```{r}
watershed_colors <- c(  
    "Agashashok River" = "#A1E3F9",   
    "Anaktok River" = "#9F8383",
    "Salmon River Watershed" = "#9F8383",
    "Salmon River" = "#2DAA9E",   
    "Kugururok River" = "#2D3D85",  
    "Nakolikurok Creek" = "#F87FC7",
    "Nakolikurok" = "#F87FC7",
    "Tukpahlearik Creek" = "#FDDE74",
    "Tukpahlearik" = "#FDDE74"
    )



cb_palette_metals <- c(
  # Major metal colors
  #"#FF7F00", "#56B4E9", "grey31", "#009E73", 
  #"#FF7F00", "#56B4E9", "grey31", "#5d9b84",
  #"#de8042", "#ffce96", "#5d455e", "#009E73",
  "#D55E00", "#ffce96", "#5d455e", 
  "#D55E00", "#ffce96", "#5d455e", 
  
  # Trace metal colors
  #"#F0E442", "#0072B2","#D55E00", "#CC79A7", "#999999", "#E41A1C", "#E69F00",
  #"#377EB8", "#4DAF4A", "#984EA3",
  #"#F0E442", "#0072B2","#D55E00", "#CC79A7", "#999999", "#E41A1C", "#E69F00",
  #"#377EB8", "#4DAF4A", "#984EA3",
  
  
  "#003f5c", "#fdb5e1", "#ffca67", "#752c48", "#80acff", "#3a5e9b", "#53B0AE", "#bc5090", "#ff6361", "#01796f",  "#bac4c8",
  "#003f5c",  "#fdb5e1", "#ffca67", "#752c48", "#80acff", "#3a5e9b", "#53B0AE", "#bc5090", "#ff6361", "#01796f",  "#bac4c8",
  
  # REE colors
  #"#FF7F00", "#A65628", "#999999", "#66C2A5", "#FC8D62", "#8DA0CB"
  
  "#bc5259", "#c5e6a1", "#ab694e","#8dbfcb",  "#4eab69", "#6d7a6b",
  "#bc5259", "#c5e6a1", "#ab694e","#8dbfcb",  "#4eab69", "#6d7a6b"
  
)

metals_ordered <- c(
  # Major
  "f_Fe_mcg_per_l", "f_Al_mcg_per_l", "f_Mn_mcg_per_l", 
  "p_Fe_mcg_per_l", "p_Al_mcg_per_l", "p_Mn_mcg_per_l", 
  # Trace
  "f_Pb_mcg_per_l", "f_Ba_mcg_per_l", "f_As_mcg_per_l", "f_Cr_mcg_per_l", "f_Cd_mcg_per_l", 
  "f_Cu_mcg_per_l", "f_Se_mcg_per_l", "f_U_mcg_per_l", "f_Co_mcg_per_l", 
  "f_Ni_mcg_per_l", "f_Zn_mcg_per_l",
  
  "p_Pb_mcg_per_l", "p_Ba_mcg_per_l", "p_As_mcg_per_l", "p_Cr_mcg_per_l", "p_Cd_mcg_per_l",
"p_Cu_mcg_per_l", "p_Se_mcg_per_l", "p_U_mcg_per_l", "p_Co_mcg_per_l",
"p_Ni_mcg_per_l", "p_Zn_mcg_per_l",
  # REE
  "f_Ce_mcg_per_l", "f_Dy_mcg_per_l", "f_Nd_mcg_per_l", "f_Pr_mcg_per_l", "f_La_mcg_per_l", "f_Y_mcg_per_l", 
"p_Ce_mcg_per_l", "p_Dy_mcg_per_l", "p_Nd_mcg_per_l", "p_Pr_mcg_per_l","p_La_mcg_per_l", "p_Y_mcg_per_l"
)

metal_colors <- cb_palette_metals
names(metal_colors) <- metals_ordered
```

### Metal order
```{r}
# Major metals
major_order <- c("f_Al_mcg_per_l", "p_Al_mcg_per_l", "f_Fe_mcg_per_l", "p_Fe_mcg_per_l", "f_Mn_mcg_per_l", "p_Mn_mcg_per_l")

# Trace metals
trace_order <- c(
"f_Pb_mcg_per_l", "p_Pb_mcg_per_l",
"f_Ba_mcg_per_l", "p_Ba_mcg_per_l", 
"f_As_mcg_per_l", "p_As_mcg_per_l",
"f_Cr_mcg_per_l", "p_Cr_mcg_per_l",
"f_Cd_mcg_per_l", "p_Cd_mcg_per_l",
"f_Cu_mcg_per_l", "p_Cu_mcg_per_l",
"f_Se_mcg_per_l", "p_Se_mcg_per_l",
"f_U_mcg_per_l",  "p_U_mcg_per_l",
"f_Co_mcg_per_l", "p_Co_mcg_per_l",
"f_Ni_mcg_per_l", "p_Ni_mcg_per_l",
"f_Zn_mcg_per_l", "p_Zn_mcg_per_l")

# REE metals
ree_order <- c(
"f_Ce_mcg_per_l", "p_Ce_mcg_per_l",
"f_Dy_mcg_per_l", "p_Dy_mcg_per_l",
"f_Nd_mcg_per_l", "p_Nd_mcg_per_l",
"f_Pr_mcg_per_l", "p_Pr_mcg_per_l",
"f_La_mcg_per_l", "p_La_mcg_per_l",
"f_Y_mcg_per_l",  "p_Y_mcg_per_l"

)

#Cations
major_cations_order <- c(
  "f_Ca_mg_l", "f_Mg_mg_l"
)

minor_cations_order <- c(
  "f_Na_mg_l", "f_K_mg_l"
)

#Anions
minor_anions_order <- c(
  "f_Cl_mg_per_l", "f_NO3_mg_per_l"
)
```


# 3. Upstream Chemistry Barplots
### DF modifications
```{r}
#view(Upstream_df) # check the column numbers

# make a data frame for all variables other than metals
Upstream_long <- Upstream_df %>%
  dplyr::select(2,19:26) %>% # select watershed and data columns
  pivot_longer(
    cols = 2:9,
    names_to = "Variable",
    values_to = "Value"
  ) %>%
  mutate(Metal_Group = case_when(
    grepl("pH|DIC|Alk|DOC", Variable) ~ "Buffering",
    TRUE ~ NA_character_  # Optional: NA if none match
  )) %>%
  # Add a column of watershed area to organize the watersheds by later
  mutate(Watershed_area = case_when(
    Watershed == "Agashashok River"     ~ 762.96,
    Watershed == "Anaktok River"        ~ 196.91,
    Watershed == "Kugururok River"      ~ 2059.42,
    Watershed == "Tukpahlearik Creek"   ~ 83.24,
    Watershed == "Salmon River"         ~ 1740.33,
    Watershed == "Nakolikurok Creek"    ~ 349.5,
    TRUE ~ NA_real_
  )) %>% 
  mutate(
    Watershed = factor(Watershed, levels = names(sort(watershed_areas)))
  )

view(Upstream_long)

# summary values to use for bar plots for data that isn't metals
Upstream_long_summary <- Upstream_long %>%
  group_by(Variable, Watershed, Metal_Group) %>%
  summarise(
    mean_value = if (all(is.na(Value))) NA_real_ else mean(Value, na.rm = TRUE),
    sd_value   = if (all(is.na(Value))) NA_real_ else sd(Value, na.rm = TRUE),
    Min        = if (all(is.na(Value))) NA_real_ else round(min(Value, na.rm = TRUE), 5),
    Max        = if (all(is.na(Value))) NA_real_ else round(max(Value, na.rm = TRUE), 5),
    Count      = sum(!is.na(Value)),
    .groups = "drop"
  )

view(Upstream_long_summary)
```

```{r}
# metal data columns only
Upstream_metals_long <- Upstream_df %>%
  dplyr::select(2, 27:105) %>% # select Watershed column and all data including the metal data columns
  pivot_longer(
    cols = 2:80,
    names_to = "Variable",
    values_to = "Value"
  ) %>%
  # Add a column for grouping the metals 
  mutate(Metal_Group = case_when(
    grepl("Al|Fe|Mn", Variable) ~ "Major",
    grepl("Pb|As|Cd|Cr|Co|Cu|Zn|Ni|U|Se|Ba", Variable) ~ "Trace",
    grepl("Ce|Dy|Nd|Pr|La|Y", Variable) ~ "REE",
    grepl("K|Na", Variable) ~ "Minor Cations",
    grepl("Cl|NO3", Variable) ~ "Minor Anions",
    grepl("Ca|Mg", Variable) ~ "Major Cations",
    grepl("SO4", Variable) ~ "Sulfate",
    TRUE ~ NA_character_
  )) %>%
  # Create a Metal_Type column and assign a letter according to the type of metal measurement (f, p, or u)
  mutate(Metal_Type = case_when(
    grepl("f_", Variable) ~ "f",
    grepl("p_", Variable) ~ "p",
    grepl("u_", Variable) ~ "u",
    TRUE ~ NA_character_
  )) %>%
  # Add a column of watershed area to organize the watersheds by later
  mutate(Watershed_area = case_when(
    Watershed == "Agashashok River"     ~ 762.96,
    Watershed == "Anaktok River"        ~ 196.91,
    Watershed == "Kugururok River"      ~ 2059.42,
    Watershed == "Tukpahlearik Creek"   ~ 83.24,
    Watershed == "Salmon River"         ~ 1740.33,
    Watershed == "Nakolikurok Creek"    ~ 349.5,
    TRUE ~ NA_real_
  )) %>%
  mutate(
    Watershed = factor(Watershed, levels = names(sort(watershed_areas)))
  )

# Replace 0 values with sqrt(2)/2 of the element detection limit
Upstream_metals_long <- Upstream_metals_long %>%
  mutate(
    Value = case_when(
      str_detect(Variable, "p_Al|p_Mn|p_Ni|p_Cu|p_Zn") & Value == 0 ~ 0.07071,
      str_detect(Variable, "p_Fe") & Value == 0 ~ 0.7071,
      str_detect(Variable, "p_Be|p_V|p_Cr|p_Co|p_As|p_Se|p_Y|p_Ag|p_Cd|p_Ba|p_La|p_Ce|p_Pr|p_Nd|p_Dy|p_Tl|p_Pb|p_Th|p_U") & Value == 0 ~ 0.007071,
      TRUE ~ Value
    )
  )

view(Upstream_metals_long)

```

```{r}
# summary of values for bar plots
Upstream_metals_long_summary <- Upstream_metals_long %>%
  group_by(Variable, Watershed, Metal_Group, Metal_Type) %>%
  summarise(
    mean_value = if (all(is.na(Value))) NA_real_ else mean(Value, na.rm = TRUE),
    sd_value   = if (all(is.na(Value))) NA_real_ else sd(Value, na.rm = TRUE),
    Min        = if (all(is.na(Value))) NA_real_ else round(min(Value, na.rm = TRUE), 5),
    Max        = if (all(is.na(Value))) NA_real_ else round(max(Value, na.rm = TRUE), 5),
    Count      = sum(!is.na(Value)),
    .groups = "drop"
  )

view(Upstream_metals_long_summary)

```

## Metal group dataframes
```{r}
df_major_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Major") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>%  # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = major_order))

view(df_major_upstream)

#write_xlsx(df_major_upstream, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Upstream Chemistry/Major metals bar plot stats.xlsx")


df_trace_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Trace") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>%  # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = trace_order))

#view(df_trace_upstream)

#write_xlsx(df_trace_upstream, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Upstream Chemistry/Trace elements bar plot stats.xlsx")


df_ree_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "REE") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>%  # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = ree_order))

#write_xlsx(df_ree_upstream, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Upstream Chemistry/REE bar plot stats.xlsx")


df_major_cations_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Major Cations") %>%
  mutate(Variable = factor(Variable, levels = major_cations_order))

df_minor_cations_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Minor Cations") %>%
  mutate(Variable = factor(Variable, levels = minor_cations_order))

df_minor_anions_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Minor Anions") %>%
  mutate(Variable = factor(Variable, levels = minor_anions_order))

df_sulfate_upstream <- Upstream_metals_long_summary %>%
  filter(Metal_Group == "Sulfate")
```

## 3.1 Major Metals
```{r}
#Grouped by watershed on the y-axis
upstream_metals_major <- df_major_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.8,
    width = 0.9,
    color = "black"
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Major Metals by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(trans = scales::pseudo_log_trans(base = 10), breaks = c(0,10,100,1000), labels = label_comma(), expand = expansion(mult = c(0, 0.06))) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "black")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.14, 0.11)))
  

upstream_metals_major

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/Major metals_V1 no legend.png", upstream_metals_major, width = 6, height = 7, dpi = 300)
```

## 3.2 Trace Metals
```{r}
#grouped by watershed on the y-axis
upstream_metals_trace_bottom <- df_trace_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.8,
    width = 0.9,
    color = "black"
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Trace Elements by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(trans = scales::pseudo_log_trans(base = 10), breaks = c(0,10,100,1000,10000,100000,1000000,10000000), labels = label_comma(), expand = expansion(mult = c(0, 0.05))) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "black")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.12, 0.11))) +
  guides(fill = guide_legend(nrow = 2))

upstream_metals_trace_bottom

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/Trace elements_V1 no legend.png", upstream_metals_trace_bottom, width = 10, height = 7, dpi = 300)

#upstream_metals_trace_top
```

```{r}
upstream_metals_trace_combo <- upstream_metals_trace_top / upstream_metals_trace_bottom + 
  plot_layout(
    heights = c(1, 4), 
    guides = "collect"
  ) & 
  theme(
    plot.margin = margin(0, 5, 0, 2), 
    panel.background = element_rect(fill = "NA", color = "NA"), # Panel background
    plot.background = element_rect(fill = "NA", color = "NA") # Plot background
  )

upstream_metals_trace_combo
```

###2.4.3 REE Metals
```{r}
#grouped by watershed on the y-axis
upstream_metals_REE <- df_ree_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.8,
    width = 0.9,
    color = "black"
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Rare Earth Elements by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
  #annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "black")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.13, 0.11)))

upstream_metals_REE

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/REE_V1 no legend.png", upstream_metals_REE, width = 7, height = 7, dpi = 300)
```

###2.4.4 Upstream Cations
Ca, Mg, Na, K
```{r}
upstream_major_cations <- df_major_cations_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  scale_fill_manual(values = c("f_Ca_mg_l" = "#087830", "f_Mg_mg_l" = "#1dcbd6")) +
  labs(
    title = "Major Cations by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "top"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0,0.05)))

upstream_major_cations

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/major cations.png", upstream_major_cations, width = 7, height = 7, dpi = 300)
```

```{r}
upstream_minor_cations <- df_minor_cations_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  scale_fill_manual(values = c("f_Na_mg_l" = "#087830", "f_K_mg_l" = "#1dcbd6")) +
  labs(
    title = "Major Cations by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "top"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0,0.05)))

upstream_minor_cations

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/minor cations.png", upstream_minor_cations, width = 7, height = 7, dpi = 300)
```

###2.4.5 Upstream Anions
SO4, Cl, NO3, PO4, HCO3(?)
```{r}
upstream_sulfate <- df_sulfate_upstream %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill = "#ffe562", color = "black", size = 0.75) +
  geom_errorbar(
    aes(ymin = mean_value - sd_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Sulfate by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

upstream_sulfate

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/SO4.png", upstream_sulfate, width = 6, height = 7, dpi = 300)

```

### 2.4.6 Dual axis
```{r}
upstream_data <- bind_rows(df_major_cations_upstream, df_sulfate_upstream)
```

```{r}
anions_cations_upstream <- upstream_data %>%
  #filter(is.finite(Scaled_Mean)) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  #scale_y_continuous(name = "Sulfate (mg/L)",sec.axis = sec_axis(~ . / 1, name = "Calcium and Magnesium (mg/L)")) +
  scale_fill_manual(values = c("f_Ca_mg_l" = "#087830", "f_Mg_mg_l" = "#1dcbd6", "f_SO4_mg_per_l" = "#ffe562")) +
  labs(x = NULL, fill = "Variable", y = NULL) +
  theme_minimal() +
  barplot_theme +
  theme(
    axis.title.y.right = element_text(color = "black"),
    axis.title.y.left = element_text(color = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0,0.05)))

anions_cations_upstream

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/dual axis cations and anions_V2.png", anions_cations_upstream, width = 4.5, height = 5, dpi = 300)
```

###2.4.6 Upstream SpC, Temp, DOC
```{r}
upstream_SpC <- Upstream_long_summary %>%
  filter(str_detect(Variable, "Spec_Cond_microS_per_cm")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "pH by Watershed",
    x = "Watershed",
    y = "SpC"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none"
  )

upstream_SpC

```

###2.4.7 Upstream Buffering Capacity
pH, DIC, Alk
```{r}
df_upstream_buffering <- Upstream_long_summary %>%
  filter(Metal_Group == "Buffering")

view(df_upstream_buffering)
```

```{r}
upstream_pH <- df_upstream_buffering %>%
  filter(str_detect(Variable, "pH")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value - sd_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "pH by Watershed",
    x = "Watershed",
    y = "pH"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none"
  )

upstream_pH

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/pH.png", seep_pH, width = 6, height = 6, dpi = 300)
```

```{r}
upstream_DIC <- df_upstream_buffering %>%
  filter(str_detect(Variable, "DIC")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "#f79fff", color = "black", size = 0.75, width = 0.6) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "DIC by Watershed",
    x = "Watershed",
    y = ylab_DIC
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  scale_y_continuous(expand = expansion(mult = c(0,0.05))) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r = 2)) 
  )

upstream_DIC

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/DIC_V2.png", upstream_DIC, width = 2.8, height = 5, dpi = 300)

```

```{r}
upstream_Alk <- df_upstream_buffering %>%
  filter(str_detect(Variable, "Alk")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "pink", color = "black", size = 0.75) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Alk by Watershed",
    x = "Watershed",
    y = ylab_Alk
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  scale_y_continuous(expand = expansion(mult = c(0,0.05))) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r = 2))
  )

upstream_Alk

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/Alk_V2.png", upstream_Alk, width = 2.8, height = 5, dpi = 300)
```

```{r}
upstream_DOC <- df_upstream_buffering %>%
  filter(str_detect(Variable, "DOC")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "#d1834a", color = "black", size = 0.75) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "DOC by Watershed",
    x = "Watershed",
    y = "DOC (mgC/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) 
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.y = element_text(margin = margin(r = 2))
  ) +
  scale_y_continuous(breaks = c(0,2,4,6,8,10), labels = c(0,2,4,6,8,10), expand = expansion(mult = c(0, 0.1)))

upstream_DOC

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S02_Upstream Chemistry by watershed/DOC_V2.png", upstream_DOC, width = 2.8, height = 5, dpi = 300)
```

# 4. Seep Chemistry
## DF modifications
Everything other than metals
```{r}
# load data if necessary from 
All_Seep_Data <- read_excel("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Datasheets/Ferrum Manuscript Datasheets/All_seep_Data.xlsx")

# remove control seeps from All_Seep_Data to plot separately in the Ficklin Diagram
Seep_control_df <- All_Seep_Data %>%
  filter(grepl("con", Field_label))

All_Seep_Data <- All_Seep_Data %>%
  filter(!grepl("con", Field_label))

All_Seep_Data <- All_Seep_Data %>%
  filter(!grepl("TukC_above_Seep2", Field_label))

#view(Seep_df) # check the column numbers

# make a data frame for all variables other than metals
Seep_long <- All_Seep_Data %>%
  dplyr::select(2,19:26) %>% # select watershed and data columns
  pivot_longer(
    cols = 2:9,
    names_to = "Variable",
    values_to = "Value"
  ) %>%
  mutate(Metal_Group = case_when(
    grepl("pH|DIC|Alk|DOC", Variable) ~ "Buffering",
    TRUE ~ NA_character_  # Optional: NA if none match
  )) %>%
  # Add a column of watershed area to organize the watersheds by later
  mutate(Watershed_area = case_when(
    Watershed == "Agashashok River"     ~ 762.96,
    Watershed == "Anaktok River"        ~ 196.91,
    Watershed == "Kugururok River"      ~ 2059.42,
    Watershed == "Tukpahlearik Creek"   ~ 83.24,
    Watershed == "Salmon River"         ~ 1740.33,
    Watershed == "Nakolikurok Creek"    ~ 349.5,
    TRUE ~ NA_real_
  )) %>% 
  mutate(
    Watershed = factor(Watershed, levels = names(sort(watershed_areas)))
  )

#view(Seep_long)

# summary values to use for bar plots for data that isn't metals
Seep_long_summary <- Seep_long %>%
  group_by(Variable, Watershed, Metal_Group) %>%
  summarise(
  mean_value = if (all(is.na(Value))) NA_real_ else mean(Value, na.rm = TRUE),
  sd_value   = if (all(is.na(Value))) NA_real_ else sd(Value, na.rm = TRUE),
  Min        = if (all(is.na(Value))) NA_real_ else round(min(Value, na.rm = TRUE), 5),
  Max        = if (all(is.na(Value))) NA_real_ else round(max(Value, na.rm = TRUE), 5),
  Count      = sum(!is.na(Value)),
  .groups = "drop"
)

#view(Seep_long_summary)
```

All metals
```{r}
# create a data frame for all metal data - filtered, unfiltered, and particulate

#view(Seep_df) # check the column numbers


Seep_metals_long <- Seep_df %>%
  dplyr::select(2,27:105) %>% #select Watershed column and all data including the metal data columns
  pivot_longer(
    cols = 2:80,
    names_to = "Variable",
    values_to = "Value"
  ) %>%
  #dplyr::filter(grepl("f_", Variable)) %>% #keep only filtered metals
  # Add a column for grouping the metals 
  mutate(Metal_Group = case_when(
    grepl("Al|Fe|Mn", Variable) ~ "Major",
    grepl("Pb|As|Cd|Cr|Co|Cu|Zn|Ni|U|Se|Ba", Variable) ~ "Trace",
    grepl("Ce|Dy|Nd|Pr|La|Y", Variable) ~ "REE",
    grepl("K|Na", Variable) ~ "Minor Cations",
    grepl("Cl|NO3", Variable) ~ "Minor Anions",
    grepl("Ca|Mg", Variable) ~ "Major Cations",
    grepl("SO4", Variable) ~ "Sulfate",
    TRUE ~ NA_character_  # Optional: NA if none match
  )) %>%
  # create a Metal_Type column and assign a letter according to the type of metal measurement (f, p, or u)
  mutate(Metal_Type = case_when(
    grepl("f_", Variable) ~ "f",
    grepl("p_", Variable) ~ "p",
    grepl("u_", Variable) ~ "u",
    TRUE ~ NA_character_ # NA if none match
  )
  ) %>%
  # Add a column of watershed area to organize the watersheds by later
  mutate(Watershed_area = case_when(
    Watershed == "Agashashok River"     ~ 762.96,
    Watershed == "Anaktok River"        ~ 196.91,
    Watershed == "Kugururok River"      ~ 2059.42,
    Watershed == "Tukpahlearik Creek"   ~ 83.24,
    Watershed == "Salmon River"         ~ 1740.33,
    Watershed == "Nakolikurok Creek"    ~ 349.5,
    TRUE ~ NA_real_
  )) %>% 
  mutate(
    Watershed = factor(Watershed, levels = names(sort(watershed_areas)))
  )

# replace 0 values with sqrt2/2 of the element detection limit
Seep_metals_long <- Seep_metals_long %>%
  mutate(
    Value = case_when(
      str_detect(Variable, "p_Al|p_Mn|p_Ni|p_Cu|p_Zn") & Value == 0 ~ 0.07071,
      str_detect(Variable, "p_Fe") & Value == 0 ~ 0.7071,
      str_detect(Variable, "p_Be|p_V|p_Cr|p_Co|p_As|p_Se|p_Y|p_Ag|p_Cd|p_Ba|p_La|p_Ce|p_Pr|p_Nd|p_Dy|p_Tl|p_Pb|p_Th|p_U") & Value == 0 ~ 0.007071,
      TRUE ~ Value  # keep existing values otherwise
    )
  )

view(Seep_metals_long)
```

```{r}
# summary of values for bar plots
Seep_metals_long_summary <- Seep_metals_long %>%
  group_by(Variable, Watershed, Metal_Group, Metal_Type) %>%
  summarise(
  mean_value = if (all(is.na(Value))) NA_real_ else mean(Value, na.rm = TRUE),
  sd_value   = if (all(is.na(Value))) NA_real_ else sd(Value, na.rm = TRUE),
  Min        = if (all(is.na(Value))) NA_real_ else round(min(Value, na.rm = TRUE), 5),
  Max        = if (all(is.na(Value))) NA_real_ else round(max(Value, na.rm = TRUE), 5),
  Count      = sum(!is.na(Value)),
  .groups = "drop"
)

view(Seep_metals_long_summary)
```

## Metal group dataframes
Create specific data frames from the previous subsets based on the Metal_Group (major, trace, REE, etc.)
```{r}
df_major_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Major") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>% # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = major_order))

#view(df_major_seep)

#write_xlsx(df_major_seep, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/Major metals bar plot stats.xlsx")


df_trace_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Trace") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>% # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = trace_order))

#view(df_trace_seep)

#write_xlsx(df_trace_seep, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/Trace elements bar plot stats.xlsx")

df_ree_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "REE") %>%
  filter(!is.na(Variable)) %>%
  filter(Metal_Type != "u") %>% # filter out unfiltered metal data
  mutate(Variable = factor(Variable, levels = ree_order))

view(df_ree_seep)

#write_xlsx(df_ree_seep, "C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/REE bar plot stats.xlsx")

df_major_cations_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Major Cations") %>%
  mutate(Variable = factor(Variable, levels = major_cations_order))

df_minor_cations_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Minor Cations") %>%
  mutate(Variable = factor(Variable, levels = minor_cations_order))

df_minor_anions_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Minor Anions") %>%
  mutate(Variable = factor(Variable, levels = minor_anions_order))

df_sulfate_seep <- Seep_metals_long_summary %>%
  filter(Metal_Group == "Sulfate")
```




### 2.5.1 Seep Major Metals
ADD A <DL ABOVE THE PARTICULATE BARS THAT LOOK LIKE 0 IN POWERPOINT
```{r}
#Grouped by watershed on the y-axis
seep_metals_major <- df_major_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable, pattern = Metal_Type)) +
  geom_bar_pattern(
    stat = "identity",
    position = position_dodge(width = 0.9),
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.8,
    size = .75,
    pattern_key_scale_factor = 0.6,
    color = "black"
  ) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "Major Metals by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(
    trans = scales::pseudo_log_trans(base = 10),
    breaks = c(0,10,100,1000,10000,100000,1000000,10000000),
    labels = label_comma(),
    expand = expansion(mult = c(0, 0.05))
  ) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe")) +
  theme_minimal() +
  barplot_theme +
  theme(
    legend.position = "top",
    axis.title.y = element_text(margin = margin(r = 1))
  ) +
  guides(fill = guide_legend(nrow = 2), pattern = guide_legend(nrow = 2)) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.2)))


seep_metals_major
```

Slightly different formatting of the barplots - no space between the bars in the same watershed
```{r}
#Grouped by watershed on the y-axis
seep_metals_major_2 <- df_major_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    color = "black",
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.8,
    width = 0.9
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Major Metals by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(trans = scales::pseudo_log_trans(base = 10), breaks = c(0,10,100,1000,10000,100000,1000000,10000000), labels = label_comma(), expand = expansion(mult = c(0, 0.06))) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "black")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.2))) +
  guides(fill = guide_legend(nrow = 2))
  

seep_metals_major_2

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/Major metals_V1 no legend.png", seep_metals_major_2, width = 5.5, height = 7, dpi = 300)
```

```{r}
stacked_seep_major_metals <- ggplot(df_major_seep, aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_bar(stat = "identity") +  # stacked by default
  scale_fill_manual(values = metal_colors) +  # your custom color vector
  labs(x = "Watershed", y = "Concentration (µg/L)", fill = "Metal") +
  scale_y_log10(labels = scales::label_comma()) +
  theme_minimal()

stacked_seep_major_metals
```

### 2.5.2 Seep Trace Metals
```{r}
#grouped by watershed on the y-axis
seep_metals_trace_bottom <- df_trace_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.75,
    width = 0.9,
    color = "black"
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Trace Elements by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(trans = scales::pseudo_log_trans(base = 10), breaks = c(0,10,100,1000,10000,100000,1000000,10000000), labels = label_comma(), expand = expansion(mult = c(0, 0.05))) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey28")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.2))) +
  guides(fill = guide_legend(nrow = 2))

seep_metals_trace_bottom

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/trace metals_V1 no legend.png", seep_metals_trace_bottom, width = 8, height = 6, dpi = 300)
```

### 2.5.3 Seep REE Metals
```{r}
#grouped by watershed on the y-axis
Seep_metals_REE <- df_ree_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
  geom_col_pattern(aes(fill = Variable, pattern = Metal_Type, pattern_fill = Metal_Type),
    position = position_dodge(width = 0.9),
    size = 0.75,
    pattern_density = 0.2,
    pattern_spacing = 0.02,
    pattern_angle = 45,
    #width = 0.75,
    alpha = 0.8,
    width = 0.9,
    color = "black"
    ) +
        #geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "Rare Earth Elements by Watershed",
    x = NULL,
    y = "Concentration (μg/L)"
  ) +
  scale_y_continuous(trans = scales::pseudo_log_trans(base = 10), breaks = c(0,10,100,1000,10000), labels = label_comma(), expand = expansion(mult = c(0, 0.05))) +
  annotation_logticks(sides = "l") +
  scale_fill_manual(values = c(metal_colors)) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey28")) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r=1))
    #axis.title.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.2))) +
  guides(fill = guide_legend(nrow = 2))

Seep_metals_REE 

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/REE_V2 no legend.png", Seep_metals_REE, width = 6, height = 6, dpi = 300)
```

### 2.5.4 Seep Cations
Ca, Mg, Na, K

Major Cations
```{r}
seep_major_cations <- df_major_cations_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  scale_fill_manual(values = c("f_Ca_mg_l" = "#087830", "f_Mg_mg_l" = "#1dcbd6")) +
  labs(
    title = "Major Cations by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "top"
  )

seep_major_cations

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/major cations.png", seep_major_cations, width = 6, height = 6, dpi = 300)
```

Minor Cations
```{r}
seep_minor_cations <- df_minor_cations_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "Minor Cations by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "top"
  )

seep_minor_cations
```

### 2.5.5 Seep Anions
SO4, Cl, NO3, PO4, HCO3(?)
```{r}
seep_minor_anions <- df_minor_anions_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "Minor Anions by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "top"
  )

seep_minor_anions
```

```{r}
seep_sulfate <- df_sulfate_seep %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill = "#ffe562", color = "black", size = 0.75) +
  geom_errorbar(
    aes(ymin = mean_value - sd_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "Sulfate by Watershed",
    x = "Watershed",
    y = "Concentration (mg/L)"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none"
  )

seep_sulfate

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/SO4.png", seep_sulfate, width = 6, height = 6, dpi = 300)

```

### 2.5.6 Dual axis
```{r}
# Define scaling factor to bring Ca and Mg up to Sulfate scale
scaling_factor <- 10

data <- bind_rows(df_major_cations_seep, df_sulfate_seep)

plot_data <- data %>%
  filter(!is.na(mean_value)) %>%
  mutate(Scaled_Mean = case_when(
    Metal_Group %in% c("Sulfate") ~ mean_value,
    Metal_Group %in% c("Major Cations") ~ mean_value * 6,
    TRUE ~ NA_real_
  )) %>%
  mutate(Scaled_SD = case_when(
    Metal_Group %in% c("Sulfate") ~ sd_value,
    Metal_Group %in% c("Major Cations") ~ sd_value * 6,
    TRUE ~ NA_real_
  ))
```

```{r}
anions_cations_seep <- plot_data %>%
  filter(is.finite(Scaled_Mean)) %>%
  ggplot(aes(x = Watershed, y = Scaled_Mean, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = Scaled_Mean, ymax = Scaled_Mean + Scaled_SD),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.05)),
    name = "Sulfate (mg/L)",
    breaks = c(0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000), 
    labels = c("0","","2000","","4000","","6000","","8000"),
    sec.axis = sec_axis(~ . / 6, 
                        name = "Calcium and Magnesium (mg/L)") #5 is the scaling factor applied to the calcium and magnesium data
                        #breaks = c(0,500,1000,1500,2000,2500,3000,3500,4000), 
                        #labels = c("0","","200","","400","","600","","800")
  ) +
  scale_fill_manual(values = c("f_Ca_mg_l" = "#087830", "f_Mg_mg_l" = "#1dcbd6", "f_SO4_mg_per_l" = "#ffe562")) +
  labs(x = NULL, fill = "Variable") +
  theme_minimal() +
  barplot_theme +
  theme(
    axis.title.y.right = element_text(color = "black"),
    axis.title.y.left = element_text(color = "black"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none"
  )

anions_cations_seep

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/dual axis cations and anions_V2.png", anions_cations_seep, width = 5, height = 5, dpi = 300)
```

###2.5.6 Seep SpC, Temp

###2.5.7 Seep Buffering Capacity
pH, DIC, Alk, DOC
```{r}
df_seep_buffering <- Seep_long_summary %>%
  filter(Metal_Group == "Buffering")

view(df_seep_buffering)
```

```{r}
seep_pH <- df_seep_buffering %>%
  filter(str_detect(Variable, "pH")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value - sd_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "pH by Watershed",
    x = "Watershed",
    y = "pH"
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

seep_pH

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/pH_V2.png", seep_pH, width = 2, height = 5, dpi = 300)
```

```{r}
seep_DOC <- df_seep_buffering %>%
  filter(str_detect(Variable, "DOC")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "#d1834a", color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "DOC by Watershed",
    x = "Watershed",
    y = "DOC (mgC/L)"
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

seep_DOC

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/DOC_V2.png", seep_DOC, width = 2, height = 5, dpi = 300)
```

```{r}
seep_Alk <- df_seep_buffering %>%
  filter(str_detect(Variable, "Alk")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "#d1834a", color = "black", size = 0.75) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = "Alk by Watershed",
    x = "Watershed",
    y = ylab_Alk
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none"
  )

seep_Alk

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry/DOC.png", seep_DOC, width = 6, height = 6, dpi = 300)
```

```{r}
seep_DIC <- df_seep_buffering %>%
  filter(str_detect(Variable, "DIC")) %>%
  ggplot(aes(x = Watershed, y = mean_value, fill = Variable)) +
        geom_bar(stat = "identity", position = position_dodge(width = 0.9), fill =  "#f79fff", color = "black", size = 0.75, alpha = 0.8) +
  geom_errorbar(
    aes(ymin = mean_value, ymax = mean_value + sd_value),
    position = position_dodge(width = 0.9),
    width = 0.3
  ) +
  labs(
    title = NULL,
    #title = "DIC by Watershed",
    x = "Watershed",
    y = ylab_DIC
  ) +
  #coord_cartesian(ylim = c(0, 6)) +
  #scale_fill_manual(values = metal_colors) +
  scale_y_continuous(breaks = c(0,2,4,6,8,10), labels = c(0,2,4,6,8,10), expand = expansion(mult = c(0, 0.05))) +
  theme_minimal() +
  barplot_theme + 
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

seep_DIC

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/S01_Seep Chemistry by watershed/DIC_V2.png", seep_DIC, width = 2, height = 5, dpi = 300)
```

# 5. Seep Ficklin Diagram
```{r}
# load data if necessary from 
All_Seep_Data <- read_excel("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Datasheets/Ferrum Manuscript Datasheets/All_seep_Data.xlsx")

# remove control seeps from All_Seep_Data to plot separately in the Ficklin Diagram
Seep_control_df <- All_Seep_Data %>%
  filter(grepl("con", Field_label))

All_Seep_Data <- All_Seep_Data %>%
  filter(!grepl("con", Field_label))

All_Seep_Data <- All_Seep_Data %>%
  filter(!grepl("TukC_above_Seep2", Field_label))
```

```{r}
Seep_ficklin <- All_Seep_Data %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, 
                pH,
                f_Cd_mcg_per_l, f_Zn_mcg_per_l, f_Cu_mcg_per_l, f_Ni_mcg_per_l, f_Co_mcg_per_l, f_Pb_mcg_per_l) %>%
  mutate(Ficklin_metals = f_Cd_mcg_per_l + f_Zn_mcg_per_l + f_Cu_mcg_per_l + f_Co_mcg_per_l + f_Ni_mcg_per_l + f_Pb_mcg_per_l) %>%
  filter(!is.na(Ficklin_metals))
```

```{r}
impaired_trib_ficklin <- Impaired_trib_df %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, 
                pH,
                f_Cd_mcg_per_l, f_Zn_mcg_per_l, f_Cu_mcg_per_l, f_Ni_mcg_per_l, f_Co_mcg_per_l, f_Pb_mcg_per_l) %>%
  mutate(Ficklin_metals = f_Cd_mcg_per_l + f_Zn_mcg_per_l + f_Cu_mcg_per_l + f_Co_mcg_per_l + f_Ni_mcg_per_l + f_Pb_mcg_per_l) %>%
  filter(!is.na(Ficklin_metals))
```

```{r}
upstream_ficklin <- Upstream_df %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, 
                pH,
                f_Cd_mcg_per_l, f_Zn_mcg_per_l, f_Cu_mcg_per_l, f_Ni_mcg_per_l, f_Co_mcg_per_l, f_Pb_mcg_per_l) %>%
  mutate(Ficklin_metals = f_Cd_mcg_per_l + f_Zn_mcg_per_l + f_Cu_mcg_per_l + f_Co_mcg_per_l + f_Ni_mcg_per_l + f_Pb_mcg_per_l) %>%
  filter(!is.na(Ficklin_metals))
```

```{r}
downstream_ficklin <- Downstream_df %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, 
                pH,
                f_Cd_mcg_per_l, f_Zn_mcg_per_l, f_Cu_mcg_per_l, f_Ni_mcg_per_l, f_Co_mcg_per_l, f_Pb_mcg_per_l) %>%
  mutate(Ficklin_metals = f_Cd_mcg_per_l + f_Zn_mcg_per_l + f_Cu_mcg_per_l + f_Co_mcg_per_l + f_Ni_mcg_per_l + f_Pb_mcg_per_l) %>%
  filter(!is.na(Ficklin_metals))
```

```{r}
Seep_metals_plot_2 <- 
  ggplot(All_Seep_Data, aes(x = pH, y = Ficklin_more_metals_mg_L, fill = Watershed)) +
  #geom_hline(yintercept = c(1, 10), linetype = "solid", color = "grey", linewidth = 0.8) + # use for mg/L scale
  geom_point(size = 3.5, shape = 21, color = "black", stroke = 1.5) +         # scatter points
  scale_fill_manual(values = boxplot_colors) +
  # geom_smooth(method = "lm", se = FALSE,        # optional trend line
  #             color = "black", linetype = "dashed") +
  labs(
    title = NULL,
    x = NULL,
    y = NULL
    # x = "pH",
    # y = "Sum of Metals (mg/L)",                 # adjust units if needed
    # color = "Watershed"
  ) +
  theme_minimal() +
  DA_theme +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5)      # center title
  )

Seep_metals_plot_2

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Seeps Ficklin Diagram_all metals.png", Seep_metals_plot, width = 5, height = 5, dpi = 300, bg = "transparent")

```


```{r}
Seep_metals_plot <- 
  ggplot(All_Seep_Data, aes(x = pH, y = sum_of_metals_mg_L, fill = Watershed)) +
  #geom_hline(yintercept = c(1, 10), linetype = "solid", color = "grey", linewidth = 0.8) + # use for mg/L scale
  geom_point(size = 3.5, shape = 21, color = "black", stroke = 1.5) +         # scatter points
  scale_fill_manual(values = boxplot_colors) +
  # geom_smooth(method = "lm", se = FALSE,        # optional trend line
  #             color = "black", linetype = "dashed") +
  labs(
    title = NULL,
    x = NULL,
    y = NULL
    # x = "pH",
    # y = "Sum of Metals (mg/L)",                 # adjust units if needed
    # color = "Watershed"
  ) +
  theme_minimal() +
  DA_theme +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5)      # center title
  )

Seep_metals_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Seeps Ficklin Diagram_V1.png", Seep_metals_plot, width = 5, height = 5, dpi = 300, bg = "transparent")

```

```{r}
Seep_ficklin_plot <- 
  ggplot(Seep_ficklin, aes(x = pH, y = Ficklin_metals, fill = Watershed)) +
  
  # horizontal lines
  #geom_hline(yintercept = c(1, 10), linetype = "solid", color = "grey", linewidth = 0.8) + # use for mg/L scale
   geom_hline(yintercept = c(1000, 100000), linetype = "solid", color = "grey", linewidth = 0.5) + # use for ug/L scale
  
  # Vertical lines
  geom_vline(xintercept = c(1, 3, 5.5), 
             linetype = "solid", color = "grey", linewidth = 0.5) +
  
  annotate("rect",
           xmin = 7.89, xmax = 8.33,   # x range of rectangle
           ymin = 1.5, ymax = 110,  # y range of rectangle
           alpha = 0.2, fill = "#72D9FF", color = NA) +
  
  # annotate("rect",
  #          xmin = 2.1, xmax = 3.5,   # x range of rectangle
  #          ymin = 350000, ymax = 700000,  # y range of rectangle
  #          fill = "white", color = NA) +

  
  # Data points
    # overlay the second dataset as a layer
  geom_point(size = 4, shape = 23, color = "black", stroke = 1.5) + #seep data
  
  geom_point(data = impaired_trib_ficklin, # impaired data
             aes(x = pH, y = Ficklin_metals, fill = Watershed),
             size = 3.2, shape = 21, color = "black", stroke = 1.5, alpha = .8) +
  
  # geom_point(data = upstream_ficklin, # upstream data
  #            aes(x = pH, y = Ficklin_metals, fill = Watershed),
  #            size = 3.2, shape = 24, color = "black", stroke = 1.5, alpha = .65) +
  
  # geom_point(data = downstream_ficklin, # upstream data
  #            aes(x = pH, y = Ficklin_metals, fill = Watershed),
  #            size = 3.2, shape = 22, color = "black", stroke = 1.5, alpha = .65) +
  
  scale_x_continuous(limits = c(2.1, 8.33),
                     expand = expansion(mult = 0, add = 0)) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    #x = "pH",
    x = NULL,
    y = NULL,   
    #y = "Sum of Zn+Cu+Cd+Pb+Co+Ni (µg/L)", 
    color = "Watershed"
  ) +
  # Labels
  # annotate("text", x = 7,    y = 9, label = "Near-neutral", size = 4, hjust = 0.5) +
  # annotate("text", x = 7,    y = 6.15, label = "Low-metal",    size = 4, hjust = 0.5) +
  # annotate("text", x = 4.25, y = 25000, label = "Acidic",        size = 4, hjust = 0.5) +
  # annotate("text", x = 4.25, y = 17500, label = "Low-metal",    size = 4, hjust = 0.5) +
  # annotate("text", x = 2.8, y = 590000, label = "High-Acid",        size = 4, hjust = 0.5) +
  # annotate("text", x = 2.8, y = 430000, label = "Extreme-metal",    size = 4, hjust = 0.5) +
  
  scale_y_log10(
    limits = c(1.5, 900000),
    labels = scales::comma,
    breaks = c(1, 10, 100, 1000, 10000, 100000, 1000000),
    minor_breaks = NULL,
    expand = expansion(mult = 0, add = 0)
  ) +
  theme_minimal() +
  DA_theme +
  theme(
    legend.position = "none",
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    plot.title = element_text(hjust = 0.5)      # center title
  )

Seep_ficklin_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Seeps Ficklin Diagram_log scale_V3_with tribs.png", Seep_ficklin_plot, width = 5, height = 5, dpi = 300, bg = "transparent")

#Seep_ficklin_plotly <- ggplotly(Seep_ficklin_plot)
#Seep_ficklin_plotly

```

# 6. Piper Diagram
Upstream
```{r}
piper_df <- working_Ferrum_data %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, 
                f_Ca_mg_l, f_Mg_mg_l, f_Na_mg_l, f_Cl_mg_per_l, f_SO4_mg_per_l, HCO3_mg_per_l)

piper_upstream <- piper_df %>%
  filter(New_Grouping == "Upstream")

# Transform data to milli-equivalents per liter
PD <- transform(piper_upstream,
Ca.meq = conc2meq(f_Ca_mg_l, "calcium"),
Mg.meq = conc2meq(f_Mg_mg_l, "magnesium"),
Na.meq = conc2meq(f_Na_mg_l, "sodium"),
Cl.meq = conc2meq(f_Cl_mg_per_l, "chloride"),
SO4.meq = conc2meq(f_SO4_mg_per_l, "sulfate"),
HCO3.meq = conc2meq(HCO3_mg_per_l, "bicarb"))


# set the SS value based on the Watershed
PD$SS <- as.numeric(factor(PD$Watershed))

# assign colors to each row based on the watershed
PD$color <- watershed_colors[PD$Watershed]

# but the axis title spacings require a graph area of at least 6 inches.
#setSweave("piperplot01", 7, 7)

# For this example, a separate graph area for an explanation is not needed
# because there are only 4 groups (individuals).
AA.pl <- with(PD, piperPlot(Ca.meq, Mg.meq, Na.meq,
                            Cl.meq, HCO3.meq, SO4.meq,
                            Plot=list(name=SS, color=setColor(color)),
                            #ticks = TRUE,
                            zCat.title = "Sodium",
                            xAn.title = "Chloride",
                            yAn.title = "Bicarbonate"))

# Manually add a legend using the same color mapping
unique_sites <- unique(PD$SS)
site_colors <- setColor(unique_sites)  # same color function as above

legend("topright",
       legend = names(watershed_colors),
       col = watershed_colors,
       pch = 16,            # same point shape as Piper plot
       bty = "n",           # no border
       title = "Site")


# converts to percent by normalizing each row of data by the total cations and total anions
# each cation is divided by the total sum of cations for that site and multiplied by 100
ion_percentage_in_piper <- PD %>% # this currently doesn't include CO3 but can be added
  mutate(
    #NaK = Na + K,
    cat_sum = Ca.meq + Mg.meq + Na.meq,
    an_sum  = Cl.meq + SO4.meq + HCO3.meq,
    Ca_percent   = 100 * Ca.meq   / cat_sum,
    Mg_percent   = 100 * Mg.meq   / cat_sum,
    Na_percent  = 100 * Na.meq  / cat_sum,
    Cl_percent   = 100 * Cl.meq   / an_sum,
    SO4_percent  = 100 * SO4.meq  / an_sum,
    HCO3_percent = 100 * HCO3.meq / an_sum
  ) %>%
  dplyr::select(Watershed, New_Grouping, sample_collection_year, Ca_percent, Mg_percent, Na_percent, Cl_percent, SO4_percent, HCO3_percent)
```

Everything by Group
```{r}
piper_df_mod <- piper_df %>%
  filter(!is.na(New_Grouping))

# Transform data to milli-equivalents per liter
PD_all <- transform(piper_df_mod,
Ca.meq = conc2meq(f_Ca_mg_l, "calcium"),
Mg.meq = conc2meq(f_Mg_mg_l, "magnesium"),
Na.meq = conc2meq(f_Na_mg_l, "sodium"),
Cl.meq = conc2meq(f_Cl_mg_per_l, "chloride"),
SO4.meq = conc2meq(f_SO4_mg_per_l, "sulfate"),
HCO3.meq = conc2meq(HCO3_mg_per_l, "bicarb"))


# set the SS value based on the Watershed
PD_all$SS <- as.numeric(factor(PD_all$New_Grouping))

# assign colors to each row based on the watershed
PD_all$color <- group_colors[PD_all$New_Grouping]

# but the axis title spacings require a graph area of at least 6 inches.
#setSweave("piperplot01", 7, 7)

# For this example, a separate graph area for an explanation is not needed
# because there are only 4 groups (individuals).
AA.pl_2 <- with(PD_all, piperPlot(Ca.meq, Mg.meq, Na.meq,
                            Cl.meq, HCO3.meq, SO4.meq,
                            Plot=list(name = New_Grouping, color = color),
                            #ticks = TRUE,
                            zCat.title = "Sodium",
                            xAn.title = "Chloride",
                            yAn.title = "Bicarbonate"))

# Manually add a legend using the same color mapping
unique_sites <- unique(PD$SS)
site_colors <- setColor(unique_sites)  # same color function as above

legend("topright",
       legend = names(group_colors),
       col = group_colors,
       pch = 16,            # same point shape as Piper plot
       bty = "n",           # no border
       title = "Site")

```

```{r}
mgL_to_meqL <- function(mgL, molar_mass, charge){
  (mgL / molar_mass) * charge
}

meq_L_df <- working_Ferrum_data %>%
  mutate(
    Ca = mgL_to_meqL(f_Ca_mg_l, 40.078, 2),
    Mg = mgL_to_meqL(f_Mg_mg_l, 24.305, 2),
    Na = mgL_to_meqL(f_Na_mg_l, 22.989, 1),
    K  = mgL_to_meqL(f_K_mg_l, 39.098, 1),
    Cl  = mgL_to_meqL(f_Cl_mg_per_l, 35.453, 1),
    SO4 = mgL_to_meqL(f_SO4_mg_per_l, 96.06, 2),   # as SO4^2-
    HCO3 = mgL_to_meqL(HCO3_mg_per_l, 61.016, 1)  # as HCO3^-
  ) %>%
  dplyr::select(Field_label,
                Watershed,
                New_Grouping,
                Field_label,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season, Ca, Mg, Na, K, Cl, SO4, HCO3) %>%
  # filter out rows with any NA in the major ion columns
  filter(if_all(c(Ca, Mg, Na, K, Cl, SO4, HCO3), ~ !is.na(.))) %>%
  # add CO3 column with all zeros
  mutate(CO3 = 0)

# converts to percent by normalizing each row of data by the total cations and total anions
# each cation is divided by the total sum of cations for that site and multiplied by 100
df_for_piper <- meq_L_df %>% # this currently doesn't include CO3 but can be added
  mutate(
    NaK = Na + K,
    cat_sum = Ca + Mg + NaK,
    an_sum  = Cl + SO4 + HCO3,
    Ca   = 100 * Ca   / cat_sum,
    Mg   = 100 * Mg   / cat_sum,
    NaK  = 100 * NaK  / cat_sum,
    Cl   = 100 * Cl   / an_sum,
    SO4  = 100 * SO4  / an_sum,
    HCO3 = 100 * HCO3 / an_sum
  )

rownames(df_for_piper) <- make.unique(as.character(meq_L_df$Watershed))

# Make a Piper object
# color by Group
pal <- c(
   "Unimpaired Tributary" = "#00589b",
  "Upstream" = "#72D9FF",
  "Seep" = "#c81600",
  "Impaired Tributary" = "indianred2",
  "Downstream MS" = "#f5a678",
  "NA" = "grey50"
)

df_for_piper$pt.col <- pal[ meq_L_df$New_Grouping ]
df_for_piper$pt.bg <- pal[ meq_L_df$New_Grouping ]

df_for_piper$pt.col[is.na(df_for_piper$pt.col)] <- "grey50"  # fallback
df_for_piper$pt.pch <- 21
p_obj <- piper(df_for_piper)

# 5. Plot it
plot(p_obj, main = "Piper Diagram (hydrogeo)")
```

```{r}
library(ggtern)
library(patchwork) 

cat_tri <- ggtern(df_for_piper, aes(x = NaK, y = Ca, z = Mg, fill = New_Grouping)) +
  geom_point(shape = 21, size = 3) +
  Tlab("Na+K") + Llab("Ca") + Rlab("Mg") +
  scale_fill_manual(values = boxplot_colors) +
  theme_bw() + 
  #theme_showarrows() +
  ggtitle("Cations") +
  theme(legend.position = "none")

an_tri <- ggtern(df_for_piper, aes(x = Cl, y = HCO3, z = SO4, fill = New_Grouping)) +
  geom_point(shape = 21, size = 3) +
   Tlab("Cl") + Llab(expression(HCO[3])) + Rlab("SO"[4]) +
  scale_fill_manual(values = boxplot_colors) +
  theme_bw() + 
  #theme_showarrows() +
  ggtitle("Anions")

cat_tri + an_tri
```

```{r}
# Diamond coordinates (simple, widely-used mapping)
diamond <- df_for_piper %>%
  mutate(
    X = 0.5 * (NaK + Cl + SO4),
    Y = 0.5 * (Ca  + HCO3)
  )

p_diamond <- ggplot(diamond, aes(x = X, y = Y, fill = New_Grouping)) +
  geom_point(shape = 21, size = 3, color = "black") +
  scale_fill_manual(values = boxplot_colors) +
  coord_equal() + theme_bw() +
  xlab(NULL) + ylab(NULL) +
  ggtitle("Diamond")

# 5) Arrange with a single legend
(cat_tri | p_diamond | an_tri) +
  plot_layout(guides = "collect") &
  theme(legend.position = "bottom")
```

# 7. Exploratory Analyses
## Ca/SO4
```{r}
Ca_SO4_molar_ratio <- working_Ferrum_data_molar %>%
  filter(!is.na(f_Ca_mol_L) & !is.na(f_SO4_mol_L)) %>% 
ggplot(aes(x = f_SO4_mol_L, y = f_Ca_mol_L, fill = Watershed)) +
  geom_point(size = 3, shape = 21, color = "black", stroke = 1) +
  scale_fill_manual(values = boxplot_colors) +
  # labs(
  #   x = expression(SO[4]^2- ~ "(mol/L)"),
  #   y = expression(Ca^{2+} ~ "(mol/L)")
  # ) +
  theme_minimal()

Ca_SO4_molar_ratio
```

```{r}
Ca_SO4_ratio <- working_Ferrum_data_molar %>%
  filter(!is.na(Ca_SO4_ratio)) %>% 
  ggplot(aes(x = Watershed, y = Ca_SO4_ratio, color = New_Grouping)) +
  # --- background shading bands (y: 0–1, 1–2, 2–5) ---
 annotate("rect", xmin = -Inf, xmax = Inf, ymin = 0, ymax = 0.6,
          fill = "grey85", color = NA, alpha = 1/2) +
# annotate("rect", xmin = -Inf, xmax = Inf, ymin = 1, ymax = 2,
#          fill = "white", color = NA, alpha = 1/2) +
# annotate("rect", xmin = -Inf, xmax = Inf, ymin = 2, ymax = 5,
#          fill = "grey85", color = NA, alpha = 1/3) +

  # points + reference lines
   geom_jitter(width = 0.15, size = 2, alpha = 0.9) +
   geom_hline(yintercept = 0.6, linetype = "dashed", color = "blue") +  # carbonate weathering
  # geom_hline(yintercept = 2, linetype = "dashed", color = "red") +   # silicate weathering

  # manual colors for New_Grouping
  scale_color_manual(values = boxplot_colors, name = "New Grouping") +

  # axes/labels
  coord_flip() +  # optional, for vertical samples
   scale_y_continuous(limits = c(0, 5), expand = expansion(mult = c(0, 0))) +
  labs(x = "Watershed", y = "Ca/SO4 molar ratio") +
  theme_minimal() +
  theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  #panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", size = 1.25),
  #axis.text.x = element_text(color = "white", size = 1),
  #axis.title.x = element_blank(),
  #axis.ticks.x = element_blank(),
  axis.text.x = element_text(size = 10, color = "black", face = "bold"),
  axis.text.y = element_text(size = 10, color = "black", face = "bold"),
  axis.title.y = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(r = 10)),
  axis.title.x = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(t = 10)),
  legend.position = "none",
  legend.box = "horizontal",
  legend.justification = "center",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 10, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", linewidth = 0.75),
  axis.ticks.y = element_line(linewidth = 0.9, color = "black"),  # Thicker y-axis ticks
  axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
) +
  guides(
    color = guide_legend(nrow = 2, ncol = 3, byrow = TRUE)
  )


Ca_SO4_ratio

# Ca_SO4_interactive <- ggplotly(Ca_SO4_ratio)
# Ca_SO4_interactive

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Chemical Weathering Analysis/Ca SO4 molar ratio by watershed_small.png", Ca_SO4_ratio, width = 6, height = 2.5, dpi = 300, scale = 1)
```

## Ca/Mg
carbonates ratio is about 1, silicates is greater than 2
```{r}
library(ggplot2)

Ca_Mg_ratio <- working_Ferrum_data_molar %>%
  filter(!is.na(Ca_Mg_ratio)) %>% 
  ggplot(aes(x = Watershed, y = Ca_Mg_ratio, color = New_Grouping)) +
  # --- background shading bands (y: 0–1, 1–2, 2–5) ---
annotate("rect", xmin = -Inf, xmax = Inf, ymin = 0, ymax = 1,
         fill = "grey95", color = NA, alpha = 1/2) +
annotate("rect", xmin = -Inf, xmax = Inf, ymin = 1, ymax = 2,
         fill = "white", color = NA, alpha = 1/2) +
annotate("rect", xmin = -Inf, xmax = Inf, ymin = 2, ymax = 5,
         fill = "grey85", color = NA, alpha = 1/3) +

  # points + reference lines
  geom_jitter(width = 0.15, size = 2, alpha = 0.9) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "blue") +  # carbonate weathering
  geom_hline(yintercept = 2, linetype = "dashed", color = "red") +   # silicate weathering

  # manual colors for New_Grouping
  scale_color_manual(values = boxplot_colors, name = "New Grouping") +

  # axes/labels
  coord_flip() +  # optional, for vertical samples
  scale_y_continuous(limits = c(0, 5), expand = expansion(mult = c(0, 0))) +
  labs(x = "Watershed", y = "Ca/Mg molar ratio") +
  theme_minimal() +
  theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", size = 1.25),
  #axis.text.x = element_text(color = "white", size = 1),
  #axis.title.x = element_blank(),
  #axis.ticks.x = element_blank(),
  axis.text.x = element_text(size = 10, color = "black", face = "bold"),
  axis.text.y = element_text(size = 10, color = "black", face = "bold"),
  axis.title.y = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(r = 10)),
  axis.title.x = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(t = 10)),
  legend.position = "none",
  legend.box = "horizontal",
  legend.justification = "center",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 10, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", linewidth = 0.75),
  axis.ticks.y = element_line(linewidth = 0.9, color = "black"),  # Thicker y-axis ticks
  axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
) +
  guides(
    color = guide_legend(nrow = 2, ncol = 3, byrow = TRUE)
  )


Ca_Mg_ratio

Ca_Mg_interactive <- ggplotly(Ca_Mg_ratio)
Ca_Mg_interactive

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Chemical Weathering Analysis/Ca Mg molar ratio by watershed_large.png", Ca_Mg_ratio, width = 5, height = 2, dpi = 300, scale = 2)
```

## Na/Cl
```{r}
library(ggplot2)

Na_Cl_ratio <- working_Ferrum_data_molar %>%
  filter(!is.na(Na_Cl_ratio)) %>% 
  ggplot(aes(x = Watershed, y = Na_Cl_ratio, color = New_Grouping)) +
  # --- background shading bands (y: 0–1, 1–2, 2–5) ---
annotate("rect", xmin = -Inf, xmax = Inf, ymin = 0, ymax = 1, fill = "grey95", color = NA, alpha = 1/2) +
#annotate("rect", xmin = -Inf, xmax = Inf, ymin = 1, ymax = 5, fill = "white", color = NA, alpha = 1/2) +
#annotate("rect", xmin = -Inf, xmax = Inf, ymin = 2, ymax = 5,fill = "grey85", color = NA, alpha = 1/3) +

  # points + reference lines
  geom_jitter(width = 0.15, size = 2, alpha = 0.9) +
  geom_hline(yintercept = 1, linetype = "dashed", color = "blue") +  # carbonate weathering
  #geom_hline(yintercept = 2, linetype = "dashed", color = "red") +   # silicate weathering

  # manual colors for New_Grouping
  scale_color_manual(values = boxplot_colors, name = "New Grouping") +

  # axes/labels
  coord_flip() +  # optional, for vertical samples
  scale_y_continuous(limits = c(0, 25), expand = expansion(mult = c(0, 0))) +
  labs(x = "Watershed", y = "Na/Cl molar ratio") +
  theme_minimal() +
  theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", size = 1.25),
  #axis.text.x = element_text(color = "white", size = 1),
  #axis.title.x = element_blank(),
  #axis.ticks.x = element_blank(),
  axis.text.x = element_text(size = 10, color = "black", face = "bold"),
  axis.text.y = element_text(size = 10, color = "black", face = "bold"),
  axis.title.y = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(r = 10)),
  axis.title.x = element_text(size = 12, color = "black", face = "bold", vjust = 1.25, margin = margin(t = 10)),
  legend.position = "none",
  legend.box = "horizontal",
  legend.justification = "center",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 10, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", linewidth = 0.75),
  axis.ticks.y = element_line(linewidth = 0.9, color = "black"),  # Thicker y-axis ticks
    axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
) +
  guides(
    color = guide_legend(nrow = 2, ncol = 3, byrow = TRUE)
  )


Na_Cl_ratio

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/Chemical Weathering Analysis/Na Cl molar ratio by watershed.png", Na_Cl_ratio, width = 5, height = 2, dpi = 300)

Na_Cl_interactive <- ggplotly(Na_Cl_ratio)
Na_Cl_interactive
```