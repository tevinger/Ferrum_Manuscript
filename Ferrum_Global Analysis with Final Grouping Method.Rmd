---
title: "Ferrum_Grouped Watersheds by Seep Proximity"
output: html_document
date: "2025-02-15"
editor_options: 
  chunk_output_type: console
---

Old codes are in Ferrum_Grouped Watershed by Proximity to Seeps in the R files folder on my desktop


# Load Packages

```{r}
library(dplyr)
library(tidyverse)
library(ggplot2)
#library(PLS205)
library(lubridate)
library(emmeans)
library(lme4)
library(ggeasy)
library(lattice)
library(rstatix)
library(ggsignif)
library(outliers)
library(ggpmisc)
library(ggpubr)
library(r2symbols)
library(stargazer)
library(ggbreak)
library(writexl)
library(ggrepel)
library(stringr)
library(ggthemes)
library(reshape)
library(RColorBrewer)
library(readxl)
library(dplyr)
library(gridExtra)
library(scales)
library(dbscan)
library(mclust)
library(devtools)
library(factoextra)
library(corrplot)
library(ggbiplot)
library(ggcorrplot)
library(GGally)
library(Hmisc)
library(ggbiplot)
library(ggfortify)
library(emmeans)
library(lme4)
library(lmerTest)
library(multcomp)
library(readxl)
library(learnr)
library(scatterplot3d)
library(vegan)
library(ggtern)
library(plotrix)
library(smwrBase)
library(smwrData)
library(smwrGraphs)
library(colorBlindness)
library(flextable)
library(officer)
library(dunn.test)
library(multcompView)
library(patchwork)
library(ggpattern)
```

## Load Data
```{r}
# Start from Alaska_DataRelease_2022_2023_Ferrum_V8
# Load if necessary
Alaska_DataRelease_2022_2023_Ferrum_V9 <- read_excel("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Datasheets/Ferrum Manuscript Datasheets/Alaska_DataRelease_2022_2023_Ferrum_V9_REE.xlsx")
```

##### Keep only the columns with data
```{r}
Grouped_Ferrum_2022_2023_data <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(ParkID,
                Watershed,
                #Subcatchment,
                New_Groups,
                New_Grouping,
                `Field label`,
                Latitude,
                Longitude,
                sample_collection_year,
                sample_collection_month,
                sample_collection_season,
                Watershed_Area,
                Relative_MS_Watershed_Area,
                SamplingEventID,
                VisualDescription,
                Site_Classification,
                Hyd_Classification,
                Distance_km,
                Elevation_ft,
                pH,
                Temp_deg_celsius,
                Diss_oxy_mg_per_l,
                Diss_oxy_percent_sat,
                Spec_Cond_microS_per_cm,
                DIC_mgC_per_l,
                Alk_mgCaCO3_per_l,
                DOC_mgC_per_l,
                f_Cl_mg_per_l,
                f_NO3_mgN_per_l,
                f_SO4_mg_per_l,
                f_Ca_mg_l,
                f_Mg_mg_l,
                f_Na_mg_l,
                f_K_mg_l,
                f_SiO2_mg_per_l,
                f_Pb_mcg_per_l, p_Pb_mcg_per_l,
                f_Ag_mcg_per_l, p_Ag_mcg_per_l,
f_Al_mcg_per_l, p_Al_mcg_per_l,
f_As_mcg_per_l, p_As_mcg_per_l,
f_Ba_mcg_per_l, p_Ba_mcg_per_l,
#f_Be_mcg_per_l, p_Be_mcg_per_l,
f_Cd_mcg_per_l, p_Cd_mcg_per_l,
f_Ce_mcg_per_l, p_Ce_mcg_per_l,
f_Co_mcg_per_l, p_Co_mcg_per_l,
f_Cr_mcg_per_l, p_Cr_mcg_per_l,
f_Cu_mcg_per_l, p_Cu_mcg_per_l,
f_Dy_mcg_per_l, p_Dy_mcg_per_l,
f_Fe_mcg_per_l, p_Fe_mcg_per_l,
f_La_mcg_per_l, p_La_mcg_per_l,
f_Mn_mcg_per_l, p_Mn_mcg_per_l,
f_Nd_mcg_per_l, p_Nd_mcg_per_l,
f_Ni_mcg_per_l, p_Ni_mcg_per_l,
f_Pr_mcg_per_l, p_Pr_mcg_per_l,
f_Se_mcg_per_l, p_Se_mcg_per_l,
#f_Th_mcg_per_l, p_Th_mcg_per_l,
f_Tl_mcg_per_l, p_Tl_mcg_per_l,
f_U_mcg_per_l, p_U_mcg_per_l,
f_V_mcg_per_l, p_V_mcg_per_l,
f_Y_mcg_per_l, p_Y_mcg_per_l,
f_Zn_mcg_per_l, p_Zn_mcg_per_l,
f_REE, p_REE,
u_Pb_mcg_per_l,
u_Ag_mcg_per_l,
u_Al_mcg_per_l,
u_As_mcg_per_l,
u_Ba_mcg_per_l,
# u_Be_mcg_per_l,
u_Cd_mcg_per_l,
u_Ce_mcg_per_l,
u_Co_mcg_per_l,
u_Cr_mcg_per_l,
u_Cu_mcg_per_l,
u_Dy_mcg_per_l,
u_Fe_mcg_per_l,
u_La_mcg_per_l,
u_Mn_mcg_per_l,
u_Nd_mcg_per_l,
u_Ni_mcg_per_l,
u_Pr_mcg_per_l,
u_Se_mcg_per_l,
# u_Th_mcg_per_l,
u_Tl_mcg_per_l,
u_U_mcg_per_l,
u_V_mcg_per_l,
u_Y_mcg_per_l,
u_Zn_mcg_per_l,
u_REE) %>%
  filter(New_Grouping != "NA") 

# Change class of the data
#Ferrum_2022_2023_data$Site_Grouping <- as.factor(Ferrum_2022_2023_data$Site_Grouping)
Grouped_Ferrum_2022_2023_data$Latitude <- as.numeric(Grouped_Ferrum_2022_2023_data$Latitude)
Grouped_Ferrum_2022_2023_data$Longitude <- as.numeric(Grouped_Ferrum_2022_2023_data$Longitude)
Grouped_Ferrum_2022_2023_data$DOC_mgC_per_l <- as.numeric(Grouped_Ferrum_2022_2023_data$DOC_mgC_per_l)
#Ferrum_2022_2023_data$sample_collection_date_mm_dd_yy <- as.Date(Ferrum_2022_2023_data$sample_collection_date_mm_dd_yy)

view(Grouped_Ferrum_2022_2023_data)
```

## Create Initial Filtered Dataframe for Plotting Groups
```{r}
Final_groups_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  filter(!is.na(New_Grouping))

working_Ferrum_data <- Final_groups_df
```

### Site Group Modifications - OLD
```{r}
# fix the site groupings for samples
working_Ferrum_data <- working_Ferrum_data %>% 
  mutate(Site_Grouping = ifelse(SamplingEventID %in%
                                  c("TukC_above_Trib2_Source_20230716_1041",
                                    "TukC_above_Seep2_20230715_1036",
                                    "SalmonR_Trib7_HW_20230717_1202",
                                    "SalmonR_MS_below_Kanatok_20230722_1505"), NA,
                                Site_Grouping),
         Site_Group = ifelse(SamplingEventID %in%
                               c("TukC_above_Trib2_Source_20230716_1041",
                                 "TukC_above_Seep2_20230715_1036",
                                 "SalmonR_Trib7_HW_20230717_1202",
                                 "SalmonR_MS_below_Kanatok_20230722_1505"), NA,
                             Site_Group),
         Site_Grouping = ifelse(SamplingEventID %in%
                                  c("SalmonR_MS_below_Kanatok_20230722_1505"), 1,
                                Site_Grouping),
         Site_Group = ifelse(SamplingEventID %in%
                               c("SalmonR_MS_below_Kanatok_20230722_1505"), 1,
                             Site_Group),
         Site_Grouping = ifelse(`Field label` == "Anak_MS_aboveTrib_1.5", NA, Site_Grouping),
         Site_Group = ifelse(`Field label` == "Anak_MS_aboveTrib_1.5", NA, Site_Group),
         Site_Grouping = ifelse(`Field label` == "Anak_Trib_1", NA, Site_Grouping),
         Site_Group = ifelse(`Field label` == "Anak_Trib_1", NA, Site_Group)
         )

working_Ferrum_data <- working_Ferrum_data %>%
  mutate(Site_Grouping = factor(Site_Grouping, levels = c(1,2,3,4,5,6)))

view(working_Ferrum_data)

```


## Calculate Alkalinity from DIC
```{r}
# practice_Ferrum_2022_2023_data was made in Downstream Analysis R file and has the metal data in it from AGU

view(working_Ferrum_data)

#change the names of the columns I will be using in this calculation
colnames(working_Ferrum_data)[colnames(working_Ferrum_data) == "Temp_deg_celsius"] <- "Temp_C"
colnames(working_Ferrum_data)[colnames(working_Ferrum_data) == "DIC_mgC_per_l"] <- "DIC_mg_L"
colnames(working_Ferrum_data)[colnames(working_Ferrum_data) == "Alk_mgCaCO3_per_l"] <- "Alk_mg_L"

```

```{r}
# Calculate Alkalinity from DIC using the function I made in the DIC and Alkalinity Calculations R file

working_Ferrum_data <- calculate_Alk_from_DIC(working_Ferrum_data, Temp_C_col = "Temp_C", DIC_mg_L_col = "DIC_mg_L", pH_col = "pH")

view(working_Ferrum_data)

# move the Alk calculated column
working_Ferrum_data <- working_Ferrum_data %>%
  relocate(Alk_mgCaCO3_l, .after = Alk_mg_L)

# add a column to show which samples Alk was calculated for
working_Ferrum_data <- working_Ferrum_data %>%
  mutate(Alk_Calc_Flag = ifelse(is.na(Alk_mg_L) & !is.na(Alk_mgCaCO3_l), "CALC", NA))

# move that calc flag column
working_Ferrum_data <- working_Ferrum_data %>%
  relocate(Alk_Calc_Flag, .after = Alk_mg_L)

# replace the Alk_mg_L (measured) column with the calculated Alk value
working_Ferrum_data <- working_Ferrum_data %>%
  mutate(Alk_mg_L = ifelse(is.na(Alk_mg_L), Alk_mgCaCO3_l, Alk_mg_L))

# remove the calculated column
working_Ferrum_data <- working_Ferrum_data %>%
  dplyr::select(-Alk_mgCaCO3_l)

```

``` {r}
group_subset <- working_Ferrum_data %>%
  filter(Site_Grouping == 1 | Site_Grouping == 2 | Site_Grouping == 5 | Site_Grouping == 6)

group_subset <- group_subset %>%
  mutate(Site_Grouping = factor(Site_Grouping, levels = c(1, 2, 5, 6)))

view(group_subset)
#str(group_subset)

```

# Summary Stats

## Sample Count
``` {r}
# calculate the count for each site_grouping for each variable that we care about
# Select relevant columns (Site_Grouping + target columns)
#selected_columns <- c(4,15:17,19:22,25:27,31,33:41,43,45:48,57,58)
selected_columns <- c(4,17:60)

# Create count table
group_counts <- working_Ferrum_data %>%
  dplyr::select(Site_Grouping, all_of(selected_columns)) %>%  # Select Site_Grouping + target variables
  pivot_longer(cols = -Site_Grouping, names_to = "Variable", values_to = "Value") %>%  # Convert wide to long format
  filter(!is.na(Value)) %>%  # Remove NA values
  group_by(Site_Grouping, Variable) %>%
  summarise(Count = n(), .groups = "drop") %>% # Count occurrences per group-variable pair
  pivot_wider(names_from = Variable, values_from = Count, values_fill = list(Count = 0))

# View output
print(group_counts)

columns_to_move <- c("pH", "Temp_deg_celsius", "Spec_Cond_microS_per_cm", "Diss_oxy_mg_per_l", "DIC_mgC_per_l", "Alk_mgCaCO3_per_l", "DOC_mgC_per_l", "f_SO4_mg_per_l", "f_Ca_mg_l", "f_Mg_mg_l")

group_counts <- group_counts %>%
  dplyr::select(Site_Grouping, all_of(columns_to_move), everything())

```

``` {r}
# Convert to flextable
group_counts_table <- flextable(group_counts)

# Save as an excel file
write_xlsx(group_counts, path = "C:/Users/tayta/Downloads/Site_Grouping Data Distribution and Density.xlsx")
```

## Mean and Std Dev

``` {r}
# calculate the count for each site_grouping for each variable that we care about
# Select relevant columns (Site_Grouping + target columns)
selected_columns <- c(4,15:53)

# Create count table
group_stats <- working_Ferrum_data %>%
  dplyr::select(Site_Grouping, all_of(selected_columns)) %>%  # Select Site_Grouping + target variables
  pivot_longer(cols = -Site_Grouping, names_to = "Variable", values_to = "Value") %>%  # Convert wide to long format
  filter(!is.na(Value)) %>%  # Remove NA values
  group_by(Site_Grouping, Variable) %>%
  summarise(
    Mean = mean(Value, na.rm = TRUE),
    SD = sd(Value, na.rm = TRUE),
    .groups = "drop") %>% # Count occurrences per group-variable pair
  mutate(Mean_SD = paste0(round(Mean, 2), " ± ", round(SD, 2))) %>%  # Combine Mean and SD into one column
  dplyr::select(Site_Grouping, Variable, Mean_SD) %>%  # Keep only necessary columns
  pivot_wider(names_from = Variable, values_from = Mean_SD)  # Convert back to wide format

# View output
print(group_stats)

columns_to_move <- c("pH", "Temp_deg_celsius", "Spec_Cond_microS_per_cm", "Diss_oxy_mg_per_l", "DIC_mgC_per_l", "Alk_mgCaCO3_per_l", "DOC_mgC_per_l", "f_SO4_mg_per_l", "f_Ca_mg_l", "f_Mg_mg_l")

group_stats <- group_stats %>%
  dplyr::select(Site_Grouping, all_of(columns_to_move), everything())

write_xlsx(group_stats, path = "C:/Users/tayta/Downloads/Proximity Grouping Stats.xlsx")
```


# Plots
## Colors
``` {r}
Site_Grouping_colors <- c(
  "1" = "#72D9FF",
  "2" = "darkred",
  "3" = "indianred2",
  "4" = "darkblue",
  "5" = "sienna1",
  "6" = "orange2"
)

Site_Group_colors <- c(
  "Upstream" = "#72D9FF",
  "Seep" = "darkred",
  "Impaired Tributary" = "indianred2",
  "Unimpaired Tributary" = "darkblue",
  "Downstream MS 1" = "sienna1",
  "Downstream MS 2" = "orange2"
)

seep_color <- c(
  "2" = "darkred"
)

watershed_colors <- c(  
    "Agashashok River" = "#A1E3F9",   
    "Anaktok River" = "#9F8383",
    "Salmon River Watershed" = "#9F8383",
    "Salmon River" = "#2DAA9E",   
    "Kugururok River" = "#2D3D85",  
    "Nakolikurok Creek" = "#F87FC7",
    "Nakolikurok" = "#F87FC7",
    "Tukpahlearik Creek" = "#FDDE74",
    "Tukpahlearik" = "#FDDE74"
    )

boxplot_colors <- c(
  "Agashashok River" = "#A1E3F9",   
    "Anaktok River" = "#9F8383",
    "Salmon River Watershed" = "#9F8383",
    "Salmon River" = "#2DAA9E",   
    "Kugururok River" = "#2D3D85",  
    "Nakolikurok Creek" = "#F87FC7",
    "Nakolikurok" = "#F87FC7",
    "Tukpahlearik Creek" = "#FDDE74",
    "Tukpahlearik" = "#FDDE74",
  #"Upstream" = "#72D9FF",
  #"Seep" = "darkred",
  #"Impaired Tributary" = "indianred2",
  #"Downstream MS 1" = "sienna1",
  #"Downstream MS 2" = "orange2",
  #"Downstream MS" = "orange2",
  #"Unimpaired Tributary" = "darkblue",
   "Unimpaired Tributary" = "#00589b",
  "Upstream" = "#72D9FF",
  "Seep" = "#c81600",
  "Impaired Tributary" = "indianred2",
  "Downstream MS" = "#f5a678",
  #"1" = "#72D9FF",
  #"2" = "darkred",
  #"3" = "indianred2",
  #"5" = "sienna1",
  #"6" = "orange2",
  #"4" = "darkblue"
  #"4" = "#003b68",
  "4" = "#00589b",
  "1" = "#72D9FF",
  "2" = "#c81600",
  "3" = "indianred2",
  #"6" = "sienna1"
  #"6" = "#ffb367",
  #"6" = "#f4a460",
  "6" = "#f5a678"
  
)

```

## Labels
```{r}
ylab_DOC <- expression(bold(DOC)~bold((mgC~L^-1)))
ylab_DIC <- expression(bold(DIC)~bold((mgC~L^-1)))
                       
ylab_Ca <- expression(bold(Ca)~bold((mg~L^-1)))
ylab_Mg <- expression(bold(Mg)~bold((mg~L^-1)))
ylab_Chloride <- expression(bold(Chloride)~bold((mg~L^-1)))
ylab_Cl <- expression(bold(Cl^-1)~bold((mg~L^-1)))
ylab_Sulfate <- expression(bold(SO[4]^-2)~bold((mg~L^-1)))
ylab_SpC <- expression(bold(Specific~Conductivity)~bold((μS~cm^-1)))
ylab_Alk <- expression(bold(Alkalinity~bold((mgCaCO[3]~L^-1))))

ylab_Zn <- expression(bold(Zn)~bold((μg~L^-1)))
ylab_Cu <- expression(bold(Cu)~bold((μg~L^-1)))
ylab_Fe <- expression(bold(Fe)~bold((μg~L^-1)))
ylab_Ni <- expression(bold(Ni)~bold((μg~L^-1)))
ylab_Mn <- expression(bold(Mn)~bold((μg~L^-1)))
ylab_Cd <- expression(bold(Cd)~bold((μg~L^-1)))
ylab_Al <- expression(bold(Al)~bold((μg~L^-1)))
ylab_Co <- expression(bold(Co)~bold((μg~L^-1)))
ylab_Se <- expression(bold(Se)~bold((μg~L^-1)))
ylab_REE <- expression(bold(Sigma~REE)~bold((μg~L^-1)))
ylab_Tl <- expression(bold(Tl)~bold((μg~L^-1)))
ylab_Pb <- expression(bold(Pb)~bold((μg~L^-1)))
ylab_As <- expression(bold(As)~bold((μg~L^-1)))

ylab_SUVA <- expression(bold(SUVA[254~nm])~(L/mg~m)) 
ylab_Sulfate_log <- expression(bold(log[10])~bold(SO[4]^-2)~bold((mg~L^-1)))
```

## Themes
```{r}
boxplot_theme <- theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", size = 1.25),
  axis.text.x = element_text(color = "white", size = 1),
  axis.title.x = element_blank(),
  axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 16, color = "black", face = "bold"),
  axis.title.y = element_text(size = 18, color = "black", face = "bold", vjust = 1.25, margin = margin(r = 10)),
  legend.position = "top",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 12, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", size = 0.75),
  axis.ticks.y = element_line(size = 0.9, color = "black"),  # Thicker y-axis ticks
    axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
)
```

```{r}
scatterplot_theme <- theme(
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank(),
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, color = "black", size = 1),
  axis.text.x = element_text(size = 16, color = "black", face = "bold"),
  axis.title.x = element_text(size = 18, color = "black", face = "bold", vjust = 1.25, margin = margin(t = 10)),
  axis.text.y = element_text(size = 16, color = "black", face = "bold"),
  axis.title.y = element_text(size = 18, color = "black", face = "bold", vjust = 1.25, margin = margin(r = 10)),
  legend.position = "top",
  legend.title = element_blank(),
  legend.background = element_rect(fill = NA),
  legend.text = element_text(size = 12, color = "black", face = "bold"),
  legend.box.background = element_rect(fill = NA, color = "black", size = 0.75),
  axis.ticks.y = element_line(size = 0.8, color = "black"),  # Thicker y-axis ticks
    axis.ticks.length.y = unit(0.1, "cm"),  # Longer tick marks
  plot.title = element_text(hjust = 0.5, size = 12, color = "black", face = "bold")
)
```

# Relative Watershed Scatterplot
## load data
```{r}
# Use this if it's been previously loaded 
working_Ferrum_data <- final_working_Ferrum_Manuscript_df

view(working_Ferrum_data)

# Use this if need to reload to R from files
#working_Ferrum_data <- read_excel("C:/Users/tevinger/OneDrive - University of California, Davis/Lab/Alaska Projects/Final Ferrum Manuscript Data Sheet.xlsx")
```

##All Watersheds
```{r}
Upstream_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Upstream") %>%
  mutate(Relative_MS_Watershed_Area = -1)
  #filter(!Watershed %in% c("Agashashok River", "Kugururok River"))

RelAcc_df <- working_Ferrum_data %>%
  filter(!is.na(Relative_MS_Watershed_Area)) 
#filter(!Watershed %in% c("Agashashok River", "Kugururok River"))
```

```{r}
Seep_df <- working_Ferrum_data %>%
  filter(New_Grouping %in% c("Seep", "Impaired Tributary")) %>%
  filter(!Watershed %in% c("Agashashok River", "Kugururok River")) %>%
  filter(!SamplingEventID == "TukC_Trib2_20230716_1219")

stats_Upstream_df <- Upstream_df %>%
  group_by(Watershed) %>%
  summarise(
    f_Zn_mcg_per_l = mean(f_Zn_mcg_per_l, na.rm = TRUE),
    sd_Zn = sd(f_Zn_mcg_per_l, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    Relative_MS_Watershed_Area = 1,
    Distance_km = 0
  )
```

```{r}
Zn_relative <- ggplot() +
  annotate("rect", xmin = -Inf, xmax = 0.2, ymin = -Inf, ymax = Inf, fill = "grey", alpha = 0.7) +
  geom_point(data = RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.3, height = 0),
             shape = 21, size = 4, alpha = 1) +
  geom_point(data = Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.6, height = 0),
             shape = 24, size = 3, alpha = 1) +
  #geom_point(data = Seep_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, color = Watershed),
             #shape = 8, size = 3) +
  scale_fill_manual(values = watershed_colors) +
    #scale_color_manual(values = watershed_colors) +
  #scale_y_log10() +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Zn,
    x = "Relative Watershed Area"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme +
  theme(
    legend.position = "none"
  )


Zn_relative
```

```{r}
Zn_distance <- ggplot() +
  geom_point(data = RelAcc_df, aes(x = Distance_km, y = f_Zn_mcg_per_l, fill = Watershed),
             shape = 21, size = 4, alpha = 1) +
  geom_point(data = stats_Upstream_df, aes(x = Distance_km, y = f_Zn_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 1, height = 0),
             shape = 24, size = 3, alpha = 1) +
  geom_point(data = Seep_df, aes(x = Distance_km, y = f_Zn_mcg_per_l, color = Watershed),
             shape = 8, size = 3) +
  scale_fill_manual(values = watershed_colors) +
    scale_color_manual(values = watershed_colors) +
  scale_y_log10() +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Zn,
    #x = "Relative Watershed Area"
    x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme


Zn_distance
```

```{r}
Cu_relative <- ggplot() +
  annotate("rect", xmin = -Inf, xmax = 0.2, ymin = -Inf, ymax = Inf, fill = "grey", alpha = 0.7) +
  geom_point(data = RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Cu_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.3, height = 0),
             shape = 21, size = 4, alpha = 1) +
  geom_point(data = Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Cu_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.6, height = 0),
             shape = 24, size = 3, alpha = 1) +
  #geom_point(data = Seep_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, color = Watershed),
             #shape = 8, size = 3) +
  scale_fill_manual(values = watershed_colors) +
    #scale_color_manual(values = watershed_colors) +
  #scale_y_log10() +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Cu,
    x = "Relative Watershed Area"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme +
  theme(
    legend.position = "none"
  )


Cu_relative
```

```{r}
Ni_relative <- ggplot() +
  annotate("rect", xmin = -Inf, xmax = 0.2, ymin = -Inf, ymax = Inf, fill = "grey", alpha = 0.7) +
  geom_point(data = RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Ni_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.3, height = 0),
             shape = 21, size = 4, alpha = 1) +
  geom_point(data = Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Ni_mcg_per_l, fill = Watershed),
             position = position_jitter(width = 0.6, height = 0),
             shape = 24, size = 3, alpha = 1) +
  #geom_point(data = Seep_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, color = Watershed),
             #shape = 8, size = 3) +
  scale_fill_manual(values = watershed_colors) +
    #scale_color_manual(values = watershed_colors) +
  #scale_y_log10() +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Ni,
    x = "Relative Watershed Area"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme +
  theme(
    legend.position = "none"
  )


Ni_relative
```

##Salmon River only
```{r}
Salmon_Upstream_df <- working_Ferrum_data %>%
  filter(New_Grouping == "Upstream") %>%
  filter(Watershed %in% c("Salmon River")) %>%
  mutate(Hyd_Classification = "Upstream Mainstem") %>%
  mutate(
    Relative_MS_Watershed_Area = 1,
    Distance_km = 0
  )

Salmon_stats_Upstream_df <- Salmon_Upstream_df %>%
  group_by(Watershed) %>%
  summarise(
    f_Zn_mcg_per_l = mean(f_Zn_mcg_per_l, na.rm = TRUE),
    sd_Zn = sd(f_Zn_mcg_per_l, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    Relative_MS_Watershed_Area = 1,
    Distance_km = 0
  )

Salmon_RelAcc_df <- working_Ferrum_data %>%
  filter(!is.na(Relative_MS_Watershed_Area)) %>%
  filter(Watershed %in% c("Salmon River"))
```

```{r}
Salmon_Zn_relative <- ggplot() +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Zn_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = p_Zn_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = p_Zn_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  scale_shape_manual(values = c("Mainstem" = 21, "Upstream Mainstem" = 24)) +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Zn,
    x = "Relative Watershed Area",
    shape = "Hyd Classification",
    color = "Watershed"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme


Salmon_Zn_relative
```

```{r}
Salmon_Cu_relative <- ggplot() +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Cu_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Cu_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = p_Cu_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = p_Cu_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  scale_shape_manual(values = c("Mainstem" = 21, "Upstream Mainstem" = 24)) +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Cu,
    x = "Relative Watershed Area",
    shape = "Hyd Classification",
    color = "Watershed"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme


Salmon_Cu_relative
```

```{r}
Salmon_Ni_relative <- ggplot() +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = f_Ni_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = f_Ni_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#2DAA9E") +
  geom_point(data = Salmon_RelAcc_df, aes(x = Relative_MS_Watershed_Area, y = p_Ni_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  geom_point(data = Salmon_Upstream_df, aes(x = Relative_MS_Watershed_Area, y = p_Ni_mcg_per_l, shape = Hyd_Classification), size = 4, alpha = 1, fill = "#1d6d66") +
  scale_shape_manual(values = c("Mainstem" = 21, "Upstream Mainstem" = 24)) +
  #geom_vline(xintercept = 0, color = "black", linetype = "dashed", size = 1) +
  labs(
    title = NULL,
    y = ylab_Ni,
    x = "Relative Watershed Area",
    shape = "Hyd Classification",
    color = "Watershed"
    #x = "Downstream Distance (km)"
  ) +
  theme_minimal() +
  scatterplot_theme


Salmon_Ni_relative
```

#Final Grouping - 5 groups from Rel watershed area

## pH 
```{r}
# Select pH data
pH_df <-  Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, pH) %>%
  filter(!is.na(New_Groups))

# Filter NA values in the grouping variable and make long format
pH_long <- pH_df %>%
  filter(!(New_Groups == "NA")) %>%
  filter(!is.na(New_Groups)) %>%
  pivot_longer(
    cols = c(pH),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
pH_long <- pH_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6"))) %>%
  mutate(New_Grouping = factor(New_Grouping, levels = c("Unimpaired Tributary", "Upstream", "Seep", "Impaired Tributary", "Downstream MS")))
```

```{r}
pH_plot_jitter <- ggplot(pH_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(aes(fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.75) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = "pH"
  ) +
   scale_y_continuous(limits = c(2.5,8.5),
                     breaks = c(3,4,5,6,7,8)) +
  annotation_logticks(sides = "l") +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 10)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.15)))

pH_plot_jitter
```

```{r}
pH_plot_no_jitter <- ggplot(pH_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75,
               outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2,
               alpha = 0.85,
               size = .75) +
  #geom_jitter(aes(fill = Watershed), 
  #            shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.75) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = "pH"
  ) +
   scale_y_continuous(limits = c(2.5,8.5),
                     breaks = c(3,4,5,6,7,8)) +
  annotation_logticks(sides = "l", size = 1.5) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.text.y = element_blank(),
    axis.title.y = element_blank(),
    axis.title.y = element_text(margin = margin(r = 10)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_blank(),   # legend title size
    legend.text = element_text(size = 14),    # legend item labels
    legend.key.size = unit(5, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.28, 0.15)))

pH_plot_no_jitter
#pH_plot_no_jitter_with_legend

# saved size: 150x325

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/pH_V3 no labels.png", pH_plot_no_jitter, width = 2.25, height = 3.25, dpi = 300)
```

```{r}
pH_count <- pH_long %>%
  group_by(New_Groups) %>%
  summarise(N = n(), .groups = "drop")  # Count observations

print(pH_count)
```

```{r}
pH_plot <- ggplot() + 

  # Boxplot and jitter for New_df_4
  geom_boxplot(data = pH_New_df_4, aes(x = factor(New_Grouping), y = pH, fill = factor(New_Groups)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = pH_New_df_4, aes(x = factor(New_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for New_df_1
  geom_boxplot(data = pH_New_df_1, aes(x = factor(New_Grouping), y = pH, fill = factor(New_Groups)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = pH_New_df_1, aes(x = factor(New_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for New_seep_df
  geom_boxplot(data = pH_New_seep_df, aes(x = factor(New_Grouping), y = pH, fill = factor(New_Groups)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = pH_New_seep_df, aes(x = factor(New_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for New_df_3
  geom_boxplot(data = pH_New_df_3, aes(x = factor(New_Grouping), y = pH, fill = factor(New_Groups)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = pH_New_df_3, aes(x = factor(New_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for New_df_6
  geom_boxplot(data = pH_New_df_6, aes(x = factor(New_Grouping), y = pH, fill = factor(New_Groups)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = pH_New_df_6, aes(x = factor(New_Grouping), y = pH, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Manual fill colors for New Groups
  scale_fill_manual(name = "New Group", values = boxplot_colors) +

  labs(
    #title = "Method 3 - pH",
    title = NULL,
    x = "Site Group",
    y = "pH"
  ) +
  scale_y_continuous(limits = c(2.5,8.5),
                     breaks = c(3,4,5,6,7,8)) +
  annotation_logticks(sides = "l") +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.12))) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r=10))
  )

pH_plot

```

```{r}
# Extracting plot legend
extract_legend <- function(ggplot_obj) {
  ggpubr::get_legend(ggplot_obj)
}

# Extract the legend
my_legend <- extract_legend(pH_plot_no_jitter)

library(ggpubr)

boxplot_legend <- ggpubr::get_legend(pH_plot_no_jitter)
png("C:/Users/tevinger/Downloads/boxplot_legend.png", width = 5, height = 5, units = "in", res = 300)
dev.off()
grid::grid.newpage()
grid::grid.draw(boxplot_legend)
dev.off()

ggsave('C:/Users/tevinger/Downloads/boxpot_legend.png', 
       my_legend, width = 5, height = 8, bg = "transparent", dpi = 300)
```

## Sulfate
```{r}
# Select pH data
SO4_df <- Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, f_SO4_mg_per_l)

# Filter NA values in the grouping variable and make long format
SO4_long <- SO4_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(f_SO4_mg_per_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

view(SO4_long)

# Factor the grouping variable to set plotting order
SO4_long <- SO4_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

```


```{r}
f_SO4_mg_per_l_counts <- working_Ferrum_data %>%
  filter(!is.na(f_SO4_mg_per_l)) %>%  # Change to pH
  group_by(New_Groups) %>%
  summarise(N = n(), .groups = "drop")  # Count observations

print(f_SO4_mg_per_l_counts)

```

```{r}
f_SO4_mg_per_l_plot <- ggplot(SO4_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85,
               size = 0.75) +
  #geom_jitter(aes(fill = Watershed), 
  #            shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.75) +

  # Manual fill colors for New Group (Boxplots)
  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  scale_y_log10(limits = c(10, 10000),
                breaks = c(10, 100, 1000, 10000),
                labels = scales::comma,
                minor_breaks = NULL) +
  annotation_logticks(sides = "l") +
  labs(
    #title = "Method 3 - sulfate",red
    title = NULL,
    x = "Site Group",
    y = ylab_Sulfate
    #y = "Sulfate Concentration (mg/L)"
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.25, 0.15))) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank()
    #axis.title.y = element_text(margin = margin(r = 1))
  )

f_SO4_mg_per_l_plot


ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/SO4_V3 no labels.png", f_SO4_mg_per_l_plot, width = 1.75, height = 3.25, dpi = 300)

```

## SpC
```{r}
# Select DOC data
SpC_df <- working_Ferrum_data %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, Spec_Cond_microS_per_cm)

# Filter NA values in the grouping variable and make long format
SpC_long <- SpC_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(Spec_Cond_microS_per_cm),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
SpC_long <- SpC_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

SpC_breaks <- seq(0,8000, by = 1000)
SpC_labels <- c(0,"",2000,"",4000,"",6000,"",8000)
SpC_labels
```

```{r}
SpC_plot <- ggplot(SpC_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  scale_y_continuous(breaks = SpC_breaks, labels = SpC_labels) +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_SpC
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

SpC_plot

```


## Chloride
```{r}
# Select DOC data
Cl_df <- working_Ferrum_data %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, f_Cl_mg_per_l)

# Filter NA values in the grouping variable and make long format
Cl_long <- Cl_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(f_Cl_mg_per_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
Cl_long <- Cl_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

Cl_breaks <- seq(0,55, by = 5)
Cl_labels <- c(0,"",10,"",20,"",30,"",40,"",50,"")
Cl_labels
```

```{r}
Cl_plot <- ggplot(Cl_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  #scale_y_continuous(breaks = Cl_breaks, labels = Cl_labels) +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Chloride
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

Cl_plot

```

## DIC
```{r}
# Select DOC data
DIC_df <- working_Ferrum_data %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, DIC_mgC_per_l)

# Filter NA values in the grouping variable and make long format
DIC_long <- DIC_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(DIC_mgC_per_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
DIC_long <- DIC_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

DIC_breaks <- seq(0,55, by = 5)
DIC_labels <- c(0,"",10,"",20,"",30,"",40,"",50,"")
DIC_labels
```

```{r}
DIC_plot <- ggplot(DIC_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  scale_y_continuous(
    breaks = DIC_breaks,
    labels = DIC_labels
  ) +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_DIC
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

DIC_plot

```

## Alkalinity
```{r}
# Select alkalinity data
Alk_df <- Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, Alk_mgCaCO3_per_l)

# Filter NA values in the grouping variable and make long format
Alk_long <- Alk_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(Alk_mgCaCO3_per_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
Alk_long <- Alk_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

Alk_breaks <- seq(0,150, by = 25)
Alk_labels <- c(0,"",50,"",100,"",150)
Alk_labels

```

```{r}
Alk_plot <- ggplot(Alk_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85,
               size = 0.75) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Alk
  ) +
  scale_y_continuous(breaks = Alk_breaks, labels = Alk_labels) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

Alk_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Alk_V3 no labels.png", Alk_plot, width = 1.75, height = 3.25, dpi = 300)

```

```{r}
Alk_mg_L_plot <- ggplot() + 
  
  # Boxplot and jitter for df_1
  geom_boxplot(data = df_1, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_1, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for seep_df
  geom_boxplot(data = seep_df, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = seep_df, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  # Boxplot and jitter for df_3
  geom_boxplot(data = df_3, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_3, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for df_5
  geom_boxplot(data = df_5, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_5, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for df_6
  geom_boxplot(data = df_6, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_6, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  # Boxplot and jitter for df_6
  geom_boxplot(data = df_4, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_4, aes(x = factor(Site_Grouping), y = Alk_mgCaCO3_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Manual fill colors
  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  #scale_color_manual(name = "Watershed", values = watershed_colors) +
  #scale_y_log10() +

  labs(
    title = NULL,
    x = "Site Group",
    y = "Alkalinity (mg/L)"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none"
  )

Alk_mg_L_plot

#ggsave("C:/Users/tayta/Downloads/Alk bp proximity_V3.png", Alk_mg_L_plot, bg = "transparent", width = 3.4, height = 5, dpi = 300)
```

## DOC
```{r}
# Select DOC data
DOC_df <- Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, DOC_mgC_per_l)

# Filter NA values in the grouping variable and make long format
DOC_long <- DOC_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(DOC_mgC_per_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
DOC_long <- DOC_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))
```

```{r}
DOC_plot <- ggplot(DOC_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85, size = 0.75) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  scale_y_log10(
    #limits = c(0.1, 60),
    #labels = scales::comma,
    breaks = c(0, 1, 10, 50),
    minor_breaks = NULL) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_DOC
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 2)),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

DOC_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/DOC_V3 no labels.png", DOC_plot, width = 1.75, height = 3.25, dpi = 300)

```

##Ca
```{r}
# Select alkalinity data
Ca_df <- Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, f_Ca_mg_l)

# Filter NA values in the grouping variable and make long format
Ca_long <- Ca_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(f_Ca_mg_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
Ca_long <- Ca_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

Ca_breaks <- seq(0,450, by = 50)
Ca_labels <- c(0,"",100,"",200,"",300,"",400,"")
Ca_labels
```

```{r}
Ca_plot <- ggplot(Ca_long, aes(x = New_Groups, y = Conc)) +
  #geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               #outlier.color = "black",
               #outlier.size = 2, alpha = 0.85) +
  geom_boxplot_pattern(
    aes(fill = New_Groups),
    pattern = "stripe",
    pattern_fill = "grey20",
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.35,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = 1
    #,color = "black"
  ) +
  #geom_jitter(aes(fill = Watershed), 
              #shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = "Ca (mg/L)"
  ) +
  #scale_y_log10(breaks = c(50, 100, 500)) +
  #annotation_logticks(sides = "l") +
  scale_y_continuous(breaks = Ca_breaks, labels = Ca_labels) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "right",
    axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(5, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

Ca_plot


```

##Mg
```{r}
# Select alkalinity data
Mg_df <- Final_groups_df %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, f_Mg_mg_l)

# Filter NA values in the grouping variable and make long format
Mg_long <- Mg_df %>%
  filter(!(New_Groups == "NA")) %>%
  pivot_longer(
    cols = c(f_Mg_mg_l),
    names_to = "Variable",
    #names_pattern = "^(.)_mgC_per_l",
    values_to = "Conc"
  ) %>%
  filter(!is.na(Conc))

# Factor the grouping variable to set plotting order
Mg_long <- Mg_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

Mg_breaks <- seq(0,1000, by = 100)
Mg_labels <- c(0,"",200,"",400,"",600,"",800,"",1000)
Mg_labels
```

```{r}
Mg_plot <- ggplot(Mg_long, aes(x = New_Groups, y = Conc)) +
  geom_boxplot(aes(fill = New_Groups), width = 0.75, outlier.shape = 16,
               outlier.color = "black",
               outlier.size = 2, alpha = 0.85, size = 0.75) +
  scale_fill_manual(values = boxplot_colors) +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Mg
  ) +
  scale_y_log10(limits = c(5, 1000),
                breaks = c(5, 10, 100, 1000)) +
  annotation_logticks(sides = "l") +
  #scale_y_continuous(breaks = Mg_breaks, labels = Mg_labels) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    #axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 6)),
    #axis.ticks.length = unit(1, "cm"),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.2, 0.15)))

Mg_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Mg_V1 labels.png", Mg_plot, width = 1.75, height = 3.25, dpi = 300)
```

## Other variables all together for now
```{r}
# Define a list of variables to plot
variables_to_plot <- c("Alk_mgCaCO3_per_l", "DIC_mgC_per_l", "pH", "Spec_Cond_microS_per_cm", "DOC_mgC_per_l", "f_NO3_mg_per_l", "f_SO4_mg_per_l", "f_Cl_mg_per_l", "f_Ca_mg_l", "f_Mg_mg_l", "Diss_oxy_mg_per_l")

# Generate plots for each variable using lapply
plots_list <- lapply(variables_to_plot, function(var) {
  ggplot() + 
    # Boxplot and jitter for df_1
    geom_boxplot(data = df_1, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = df_1, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    # Boxplot and jitter for seep_df
    geom_boxplot(data = seep_df, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = seep_df, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    # Boxplot and jitter for df_3
    geom_boxplot(data = df_3, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = df_3, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    # Boxplot and jitter for df_5
    geom_boxplot(data = df_5, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = df_5, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    # Boxplot and jitter for df_6
    geom_boxplot(data = df_6, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = df_6, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    # Boxplot and jitter for df_4
    geom_boxplot(data = df_4, aes_string(x = "factor(Site_Grouping)", y = var, fill = "factor(Site_Group)"), 
                 width = 0.75, outlier.shape = NA, alpha = 0.5) +
    geom_jitter(data = df_4, aes_string(x = "factor(Site_Grouping)", y = var, fill = "Watershed"), 
                shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
    
    
    # Manual fill colors for Site Group (Boxplots)
    scale_fill_manual(name = "Site Group", values = boxplot_colors) +
    
    #coord_cartesian(y = c(0, 100)) +
    scale_y_log10() +
    
    # Labels
    labs(
      title = paste("Comparison of", var, "by Proximity to Seeps"),
      x = "Site Group",
      y = paste(var, "(Units)")
    ) +
    #geom_vline(xintercept = 3.5, linetype = "solid", color = "darkgrey", size = 0.75) +
    
    # Theme settings
    theme_minimal() +
    theme(
      axis.text.x = element_blank(),  
      #plot.title = element_blank(),  
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      axis.text.y = element_text(size = 24, color = "black", face = "bold", margin = margin(r = 10)),
      axis.ticks.y = element_line(size = 0.8, color = "black"),
      legend.position = "none",
      panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
      panel.background = element_rect(fill = "transparent"),  
      plot.background = element_rect(fill = "transparent", color = NA)
    )
})

# View the first plot as an example
plots_list[[1]]

# View each plot one by one
for (i in seq_along(plots_list)) {
  print(plots_list[[i]])
}

```

## Practice plotting 0 values
```{r}
library(ggplot2)

# Sample data
data <- data.frame(
  x = rep(1, 4),
  y = c(0, 1, 10, 100)
)
data_2 <- data.frame(
  x = rep(1, 4),
  y = c(0.001, 1.001, 10.001, 100.001)
)

# Plot with log10 transformation on y-axis
practice_data <- ggplot(data, aes(x = x, y = y)) +
  geom_boxplot() +
  geom_point() +
  scale_y_continuous(trans = 'log10') +
  #labs(title = "raw data", y = "raw scale") +
  labs(title = "Log10 Transformation of Y-Axis plus 0.001", y = "Log10(Y)") +
  boxplot_theme

practice_raw
practice_log # zero value is removed by the scale_y_log10 function for the y-axis before calculating the boxplot statistics and then the 0 is added back to the plot as a point at the very bottom of the plot boundary
practice_plus_one_log
practice_plus_0.001_log
practice_data

#Output:
#The y-axis will display values like 1, 10, 100, 1000, etc., evenly spaced.
#The data points will be plotted according to their logarithmic values, making trends easier to observe.
#If you encounter issues with zeros or negatives, consider preprocessing your data before applying the transformation.

scale_y_log10(
    limits = c(.001, 150),
    labels = scales::comma,
    breaks = c(.001, 1, 10, 100
               #, 1000, 10000, 100000, 1000000, 10000000
               ),
    minor_breaks = NULL
    ) +

```

## individual metal df
## Fe 
```{r}
# Select Fe data
Fe_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, f_Fe_mcg_per_l, f_Fe_mcg_per_l_qa, p_Fe_mcg_per_l, p_Fe_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Fe_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Fe_long <- Fe_df %>%
  #filter(!(New_Groups == "NA")) %>%
  #filter(p_Fe_mcg_per_l >= 0.01) %>%
  pivot_longer(
    cols = c(f_Fe_mcg_per_l, p_Fe_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Fe_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*1), 
                                  Metal_conc))

view(Fe_long)

Fe_counts_df <- Fe_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Fe_counts_df)

# Factor the grouping variable to set plotting order
Fe_long <- Fe_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3",  "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Fe_long <- Fe_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p","3_f", "3_p", "6_f", "6_p")
    )
  )
```

```{r}
Fe_plot <- ggplot(Fe_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
    #,color = "black"
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.7, 1500000),
    labels = scales::comma,
    breaks = c(1, 10, 100, 1000, 10000, 100000, 1000000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    #title = "Method 3 - Fe",
    title = NULL,
    x = NULL,
    #y = "Concentration (µg/L)",
    y = ylab_Fe,
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Fe_plot

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Fe_V3 no labels.png", Fe_plot, width = 2.75, height = 3.25, dpi = 300)
```

Extract the legend
```{r}
library(cowplot)

proximity_metal_plot_legend <- get_legend(Fe_plot)

library(grid)

grid.draw(proximity_metal_plot_legend)

ggsave('C:/Users/tevinger/Downloads/proximity_metal_plot_legend.png', 
       proximity_metal_plot_legend, width = 5, height = 8, bg = "transparent", dpi = 250)
```


## Zn 
```{r}
# Select Zn data
Zn_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Zn_mcg_per_l, f_Zn_mcg_per_l_qa, p_Zn_mcg_per_l, p_Zn_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Zn_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Zn_long <- Zn_df %>%
  pivot_longer(
    cols = c(f_Zn_mcg_per_l, p_Zn_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Zn_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*0.1), 
                                  Metal_conc))

#view(Zn_long)

Zn_counts_df <- Zn_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Zn_counts_df)

# Factor the grouping variable to set plotting order
Zn_long <- Zn_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Zn_long <- Zn_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )

```

```{r}
Zn_plot <- ggplot(Zn_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = 0.75
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.05, 300000),
    labels = scales::comma,
    breaks = c(0.1, 1, 10, 100, 1000, 10000, 100000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Zn,  # make sure ylab_Zn is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    #axis.text.y = element_blank(),
    axis.title.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines")
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.115, 0.065)))

Zn_plot

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Zn_V2 no labels.png", Zn_plot, width = 2.75, height = 3.25, dpi = 300)
```

##Ni
```{r}
# Select Ni data
Ni_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Ni_mcg_per_l, f_Ni_mcg_per_l_qa, p_Ni_mcg_per_l, p_Ni_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Ni_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Ni_long <- Ni_df %>%
  pivot_longer(
    cols = c(f_Ni_mcg_per_l, p_Ni_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Ni_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*0.1), 
                                  Metal_conc))

#view(Ni_long)

Ni_counts_df <- Ni_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Ni_counts_df)

# Factor the grouping variable to set plotting order
Ni_long <- Ni_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Ni_long <- Ni_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )

```

```{r}
Ni_plot <- ggplot(Ni_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.05, 20000),
    labels = scales::comma,
    breaks = c(0.1, 1, 10, 100, 1000, 10000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Ni,  # make sure ylab_Ni is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    #axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines"),
    axis.title.y = element_blank(),
    axis.text.y = element_blank()
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.115, 0.065)))

Ni_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Ni_V2 no labels.png", Ni_plot, width = 2.75, height = 3.25, dpi = 300)

```

## REE
```{r}
# Select REE sum data
REE_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_REE, f_REE_qa, p_REE, p_REE_qa) %>%
  filter(!(is.na(New_Grouping)))

view(REE_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
REE_long <- REE_df %>%
  pivot_longer(
    cols = c(f_REE, p_REE),
    names_to = "Metal_type",
    names_pattern = "^(.)_REE",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*0.01), 
                                  Metal_conc))

view(REE_long)

REE_counts_df <- REE_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

view(REE_counts_df)

# Factor the grouping variable to set plotting order
REE_long <- REE_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
REE_long <- REE_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )

```


```{r}
REE_plot <- ggplot(REE_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.005, 10500),
    labels = scales::comma,
    breaks = c(0.01, 0.1, 1, 10, 100, 1000, 10000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_REE,  # make sure ylab_Ni is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    #axis.title.y = element_text(margin = margin(r = 1)),
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines")
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.115, 0.065)))

REE_plot

ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/REE_V2 no labels.png", REE_plot, width = 2.75, height = 3.25, dpi = 300)

```

### Fe Violin
```{r}
Fe_plot_violin <- ggplot(Fe_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_violin(
    aes(fill = New_Groups),
    scale = "width",
    trim = FALSE,
    alpha = 0.4
  ) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.35,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.5,
    alpha = 0.85,
    size = .75
    #,color = "black"
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.0001, 100000000),
    labels = scales::comma,
    breaks = c(0.0001, 0.01, 1, 100, 10000, 1000000, 100000000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    #title = "Method 3 - Fe",
    title = NULL,
    x = NULL,
    #y = "Concentration (µg/L)",
    y = ylab_Fe,
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Fe_plot_violin
```

# jitter code
```{r}
geom_jitter(
    aes(fill = Watershed),
    shape = 21,        # Hollow circles with fill color
    size = 2,          # Adjust size as needed
    width = 0.15,      # Horizontal jitter (adjust as needed)
    alpha = 0.7        # Slight transparency
  ) +
```

####Combo plot
```{r}
combined_plot <- plot_grid(
  pH_plot, f_SO4_mg_per_l_plot, Fe_plot, 
  ncol = 3,
  rel_widths = c(0.8, 0.95, 1.5))

combined_plot
```


##Al
```{r}
# Select Al data
Al_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Al_mcg_per_l, f_Al_mcg_per_l_qa, p_Al_mcg_per_l, p_Al_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Al_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Al_long <- Al_df %>%
  pivot_longer(
    cols = c(f_Al_mcg_per_l, p_Al_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Al_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
   mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*.1), 
                                  Metal_conc))

#view(Al_long)

Al_counts_df <- Al_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Al_counts_df)

# Factor the grouping variable to set plotting order
Al_long <- Al_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Al_long <- Al_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )


```

```{r}
Al_plot <- ggplot(Al_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
    #,color = "black"
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
scale_y_log10(
    limits = c(0.07, 5000000),
    labels = scales::comma,
    breaks = c(0.1, 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Al,  # make sure ylab_Al is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Al_plot

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Al_V2 no labels.png", Al_plot, width = 2.75, height = 3.25, dpi = 300)
```

## Cu
```{r}
# Select Cu data
Cu_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Cu_mcg_per_l, f_Cu_mcg_per_l_qa, p_Cu_mcg_per_l, p_Cu_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Cu_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Cu_long <- Cu_df %>%
  pivot_longer(
    cols = c(f_Cu_mcg_per_l, p_Cu_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Cu_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*.1), 
                                  Metal_conc))

#view(Cu_long)

Cu_counts_df <- Cu_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Cu_counts_df)

# Factor the grouping variable to set plotting order
Cu_long <- Cu_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Cu_long <- Cu_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )

```

```{r}
Cu_plot <- ggplot(Cu_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
    #,color = "black"
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.07, 5000),
    labels = scales::comma,
    breaks = c(0.01, 0.1, 1, 10, 100, 1000, 10000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Cu,  # make sure ylab_Cu is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    #axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),   # legend title size
    legend.text = element_text(size = 12),    # legend item labels
    legend.key.size = unit(3, "lines")      # size of legend keys (symbols)
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Cu_plot

#ggsave("C:/Users/tevinger/Box/Poulin Lab ETOX/Project Folders/Alaska BITE_HEAT (Taylor Evinger)/Evinger Manuscripts/Ferrum Manuscript/Figures/02_Global Analysis/Cu_V2 no labels.png", Cu_plot, width = 2.75, height = 3.25, dpi = 300)
```



####Combo plot
```{r}
metal_combo_plot <- plot_grid(
  Cu_plot, Zn_plot, Ni_plot, 
  ncol = 3,
  rel_widths = c(1.4,1,1))

metal_combo_plot
```

##Cd
```{r}
# Select Cd data
Cd_df <- Alaska_DataRelease_2022_2023_Ferrum_V9 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Cd_mcg_per_l, f_Cd_mcg_per_l_qa, p_Cd_mcg_per_l, p_Cd_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

view(Cd_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Cd_long <- Cd_df %>%
  pivot_longer(
    cols = c(f_Cd_mcg_per_l, p_Cd_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Cd_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = ifelse(Metal_conc == 0, 
                                  Metal_conc + ((sqrt(2)/2)*.01), 
                                  Metal_conc))

#view(Cd_long)

Cd_counts_df <- Cd_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Cd_counts_df)

# Factor the grouping variable to set plotting order
Cd_long <- Cd_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Cd_long <- Cd_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )
```


```{r}
Cd_plot <- ggplot(Cd_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.15,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = .75
    #,color = "black"
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.001, 800),
    labels = scales::comma,
    breaks = c(0.001, 0.01, 0.1, 1, 10, 100, 1000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Cd,  # make sure ylab_Cd is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines")
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Cd_plot

```

##Co
```{r}
# Select Co data
Co_df <- Alaska_DataRelease_2022_2023_Ferrum_V8 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Co_mcg_per_l, f_Co_mcg_per_l_qa, p_Co_mcg_per_l, p_Co_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Co_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Co_long <- Co_df %>%
  pivot_longer(
    cols = c(f_Co_mcg_per_l, p_Co_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Co_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = Metal_conc + 0.001)

#view(Co_long)

Co_counts_df <- Co_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Co_counts_df)

# Factor the grouping variable to set plotting order
Co_long <- Co_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Co_long <- Co_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )


```

```{r}
Co_plot <- ggplot(Co_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.35,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = 0.75
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.001, 100000),
    labels = scales::comma,
    breaks = c(0.001, 0.01, 0.1, 1, 10, 100, 1000, 10000, 100000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Co,  # make sure ylab_Co is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines")
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Co_plot


```

## Se 
```{r}
# Select Se data
Se_df <- Alaska_DataRelease_2022_2023_Ferrum_V8 %>%
  dplyr::select(SamplingEventID, Watershed, New_Groups, New_Grouping, 
                f_Se_mcg_per_l, f_Se_mcg_per_l_qa, p_Se_mcg_per_l, p_Se_mcg_per_l_qa) %>%
  filter(!(is.na(New_Grouping)))

#view(Se_df)

# Filter NA values in the grouping variable, filter particulate concentrations and make long format
Se_long <- Se_df %>%
  pivot_longer(
    cols = c(f_Se_mcg_per_l, p_Se_mcg_per_l),
    names_to = "Metal_type",
    names_pattern = "^(.)_Se_mcg_per_l",
    values_to = "Metal_conc"
  ) %>%
  filter(!is.na(Metal_conc)) %>% # filtering out here means only the f or p value that is NA is excluded, not both measurements for the same sample
  mutate(Metal_conc_plot = Metal_conc + 0.001)

#view(Se_long)

Se_counts_df <- Se_long %>%
  group_by(New_Grouping, Metal_type) %>%
  summarise(count = n(), .groups = "drop")

#view(Se_counts_df)

# Factor the grouping variable to set plotting order
Se_long <- Se_long %>%
  mutate(New_Groups = factor(New_Groups, levels = c("4", "1", "2", "3", "6")))

# Create a new variable that combines the groups and metal_type for plotting order
Se_long <- Se_long %>%
  mutate(
    x_group = factor(
      interaction(New_Groups, Metal_type, sep = "_"),
      levels = c("4_f", "4_p", "1_f", "1_p", "2_f", "2_p", "3_f", "3_p", "6_f", "6_p")
    )
  )

```


```{r}
Se_plot <- ggplot(Se_long, aes(x = x_group, y = Metal_conc_plot)) +
  geom_boxplot_pattern(
    aes(fill = New_Groups, pattern = Metal_type, pattern_fill = Metal_type),
    outlier.shape = 16,
    outlier.color = "black",
    outlier.size = 2, 
    pattern_density = 0.35,
    pattern_spacing = 0.015,
    pattern_angle = 45,
    width = 0.75,
    alpha = 0.85,
    size = 0.75
  ) +
  scale_fill_manual(values = boxplot_colors) +
  scale_pattern_manual(values = c("f" = "none", "p" = "stripe"), name = "Metal Type") +
  scale_pattern_fill_manual(values = c("f" = NA, "p" = "grey20")) +
  scale_y_log10(
    limits = c(0.001, 2000),
    labels = scales::comma,
    breaks = c(0.001, 0.01, 0.1, 1, 10, 100, 1000),
    minor_breaks = NULL
  ) +
  annotation_logticks(sides = "l") +
  labs(
    title = NULL,
    x = NULL,
    y = ylab_Se,  # make sure ylab_Se is defined
    fill = "Metal Type"
  ) +
  theme_minimal() +
  boxplot_theme +
  theme(
    legend.position = "none",
    axis.title.y = element_text(margin = margin(r = 1)),
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12),
    legend.key.size = unit(3, "lines")
  ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.065)))

Se_plot


```

## Pb
```{r}
## Pb Sum
Pb_Sum_df <- working_Ferrum_data %>%
  dplyr::select(SamplingEventID, Watershed, Site_Group, Site_Grouping, `f_Pb Sum_mcg_per_l`, `p_Pb Sum_mcg_per_l`) %>%
  mutate(`p_Pb Sum_mcg_per_l` = ifelse(`p_Pb Sum_mcg_per_l` <= 0.01, NA, `p_Pb Sum_mcg_per_l`)) %>%
  mutate(p_Pb_Sum_mcg_per_l = `p_Pb Sum_mcg_per_l`,
         f_Pb_Sum_mcg_per_l = `f_Pb Sum_mcg_per_l`)


  filter(f_Pb_Sum_mcg_per_l > 0.01) %>%
  filter(p_Pb_Sum_mcg_per_l > 0.01)

view(Pb_Sum_df)

```

```{r}
Pb_Sum_df_1_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 1) 

Pb_Sum_seep_df_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 2)

view(Pb_Sum_seep_df_metal)

Pb_Sum_df_3_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 3) 

Pb_Sum_df_4_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 4)

Pb_Sum_df_5_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 5) 

Pb_Sum_df_6_metal <- Pb_Sum_df %>%
  filter(Site_Grouping == 6)

```

```{r}
Pb_Sum_plot <- ggplot() + 
  #geom_hline(yintercept = 2.5, size = 0.7, color = "red") + # CCC value at 100 mg/L
  # Boxplot and jitter for Site_Grouping 1
  geom_boxplot(data = Pb_Sum_df_1_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_1_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_df_1_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_1_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for Site_Grouping 2
  geom_boxplot(data = Pb_Sum_seep_df_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_seep_df_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_seep_df_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_seep_df_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for Site_Grouping 3
  geom_boxplot(data = Pb_Sum_df_3_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_3_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  geom_boxplot(data = Pb_Sum_df_3_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_3_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for Site_Grouping 5
  geom_boxplot(data = Pb_Sum_df_5_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_5_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_df_5_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_5_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +

  # Boxplot and jitter for Site_Grouping 6
  geom_boxplot(data = Pb_Sum_df_6_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_6_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_df_6_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_6_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_df_4_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_4_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = f_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  geom_boxplot(data = Pb_Sum_df_4_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = Pb_Sum_df_4_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = p_Pb_Sum_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2) +
  
  ylim(0.01, 500) +
  scale_y_log10(limits = c(.01, 500), labels = scales::comma,
                breaks = scales::trans_breaks("log10", function(x)10^x)) +

  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  theme_minimal() +
  theme(
      axis.text.x = element_blank(),  
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      axis.text.y = element_text(size = 24, color = "black", face = "bold", margin = margin(r = 10)),
      axis.ticks.y = element_line(size = 0.8, color = "black"),
      plot.title = element_blank(),
      legend.position = "none",
      panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
      panel.background = element_rect(fill = "transparent"),  
      plot.background = element_rect(fill = "transparent", color = NA),
      axis.ticks.x = element_line(size = 0.8, color = "black"), # Make x-axis ticks visible
      axis.ticks.length = unit(5, "pt")
    ) +
  scale_x_discrete(expand = expansion(mult = c(0.11, 0.08))) +
  annotation_logticks(sides = "l")

Pb_Sum_plot

ggsave("C:/Users/tayta/Downloads/Pb bp proximity_V1.png", Pb_Sum_plot, bg = "transparent", width = 4.5, height = 5, dpi = 300)


```


### Filtered Se
``` {r}
# Compute counts per Site_Grouping
Se_counts <- working_Ferrum_data %>%
  filter(Site_Grouping == 1 | Site_Grouping == 2 | Site_Grouping == 5 | Site_Grouping == 6) %>%
  filter(!is.na(Se_mcg_per_l)) %>%
  group_by(Site_Grouping, Site_Group) %>%
  summarise(N = n(), .groups = "drop")  # Count observations

print(Se_counts)  # Check the count data
```

``` {r}
library(ggplot2)

filtered_Se_mcg_per_l_plot <- ggplot() +
  
  # Boxplot and jitter for df_1
  geom_boxplot(data = df_1, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_1, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2.5) +

  # Boxplot and jitter for seep_df
  geom_boxplot(data = seep_df, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = seep_df, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2.5) +
  
  # Boxplot and jitter for df_3
  geom_boxplot(data = df_3, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_3, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2.5) +

  # Boxplot and jitter for df_5
  geom_boxplot(data = df_5, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_5, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2.5) +

  # Boxplot and jitter for df_6
  geom_boxplot(data = df_6, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = df_6, aes(x = factor(Site_Grouping), y = f_Se_mcg_per_l, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 2.5) +

  # Manual fill colors for Site Group (Boxplots)
  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  scale_y_log10(limits = c(0.1, 1000), labels = scales::comma,
                breaks = scales::trans_breaks("log10", function(x)10^x),
                minor_breaks = NULL) +
  # Labels
  labs(
    title = "Comparison of pH by Proximity to Seeps",
    x = "Site Group",
    y = "pH"
  ) +
  
  # Theme settings
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),  
    plot.title = element_blank(),  
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y = element_text(size = 22, color = "black", face = "bold", margin = margin(r = 15)),
    legend.position = "right",
    panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
    panel.background = element_rect(fill = "transparent"),  
    plot.background = element_rect(fill = "transparent", color = NA)  
  ) 

pH_plot

# Display the plot
filtered_Se_mcg_per_l_plot
```

## Pb filtered and particulate

```{r}
Pb_Sum_plot <- ggplot() + 
  
  # Boxplot and jitter for Site_Grouping 1
  geom_boxplot(data = f_df_1_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = f_df_1_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  geom_boxplot(data = p_df_1_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = p_df_1_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  # Boxplot and jitter for Site_Grouping 2
  geom_boxplot(data = f_seep_df_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = f_seep_df_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  geom_boxplot(data = p_seep_df_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = p_seep_df_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for Site_Grouping 3
  geom_boxplot(data = f_df_3_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = f_df_3_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  geom_boxplot(data = p_df_3_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = p_df_3_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for Site_Grouping 5
  geom_boxplot(data = f_df_5_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = f_df_5_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  geom_boxplot(data = p_df_5_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = p_df_5_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Boxplot and jitter for Site_Grouping 6
  geom_boxplot(data = f_df_6_metal, 
               aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Group)), 
               width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = f_df_6_metal, 
              aes(x = interaction(Site_Grouping, "f"), y = `f_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +
  
  geom_boxplot(data = p_df_6_metal, 
               aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`), 
               fill = "darkgrey", width = 0.75, outlier.shape = NA, alpha = 0.5) +
  geom_jitter(data = p_df_6_metal, 
              aes(x = interaction(Site_Grouping, "p"), y = `p_Pb Sum_mcg_per_l`, fill = Watershed), 
              shape = 21, color = "black", width = 0.15, alpha = 1, size = 1.5) +

  # Manual fill colors
  scale_fill_manual(name = "Site Group", values = boxplot_colors) +
  scale_y_log10(limits = c(1, 100), labels = scales::comma,
                breaks = scales::trans_breaks("log10", function(x)10^x),
                minor_breaks = NULL) +
  labs(
    title = "Comparison of Pb Sum by Proximity to Seeps",
    x = "Site Group",
    y = "Pb Sum Concentration (mcg/L)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 14, color = "black", face = "bold", angle = 45, hjust = 1),  
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5),  
    axis.title.x = element_text(size = 14, face = "bold"),
    axis.title.y = element_text(size = 14, face = "bold"),
    axis.text.y = element_text(size = 12, color = "black"),
    legend.position = "right",
    panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
    panel.background = element_rect(fill = "transparent"),  
    plot.background = element_rect(fill = "transparent", color = NA)  
  ) 

Pb_Sum_plot

```

### filtered Pb
```{r}
f_Pb_Sum_mcg_per_l_plot <- working_Ferrum_data %>%
  filter(Site_Grouping %in% c(1,2,5,6)) %>%
  ggplot(aes(x = factor(Site_Grouping), y = `f_Pb Sum_mcg_per_l`, fill = factor(Site_Grouping))) +
  geom_boxplot(width = 0.75) + # Boxplot for each Site_Grouping
  #geom_jitter(width = 0.1, alpha = 1, color = "black", size = 1) + # Add jittered points for individual data
  #facet_wrap(~ VisualDescription, ncol = 3, scales = "fixed") + # Facet by watershed (SiteName)
  scale_fill_manual(values = Site_Grouping_colors) +
  #coord_cartesian(ylim = c(0.19,1000000)) +
  scale_y_log10(labels = label_comma()) +
  
  labs(
    title = "Comparison of Pb Sum by Proximity to Seeps",
    x = "Site Grouping",
    y = "Pb_Sum_log"
    #fill = "Impaired_Status"
  ) +
  geom_text(
    data = Se_counts, # Ensure this dataset has `Site_Grouping` and `N`
    aes(x = factor(Site_Grouping), y = 0.07, label = paste0("N=", N)), 
    size = 6, fontface = "bold", vjust = 0
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),  # Remove x-axis labels
    plot.title = element_blank(),  # Remove title
    axis.title.x = element_blank(),
    axis.title.y = element_text(color = "black", face = "bold", size = 18),
    axis.text.y = element_text(size = 22, color = "black", face = "bold", margin = margin(r = 15)),
    legend.position = "none",
    legend.text = element_text(size = 24, color = "black", face = "bold"),
    legend.title = element_text(size = 17, face = "bold"),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5),
    panel.background = element_rect(fill = "transparent"), # Panel background
    plot.background = element_rect(fill = "transparent", color = NA) # Plot background
  ) 

# Display the plot
f_Pb_Sum_mcg_per_l_plot

```

## Final figures

```{r}
pH_plot
f_SO4_mg_per_l_plot
DIC_mg_L_plot
Alk_mg_L_plot
Fe_plot
Zn_plot
Se_plot

```


# Seep Characterization
```{r}
seep_data <- working_Ferrum_data %>%
  #filter(Hyd_Classification == "Seep")
  filter(Site_Grouping == "2")
  
view(seep_data)
```

```{r}
# normalize metals to sulfate concentration

seep_data <- seep_data %>%
  mutate(across(c(f_Fe_mcg_per_l, f_Mn_mcg_per_l, f_Co_mcg_per_l, f_Ni_mcg_per_l, f_Zn_mcg_per_l, 
                  f_As_mcg_per_l, f_Ba_mcg_per_l, f_Be_mcg_per_l, f_Cd_mcg_per_l, f_Ce_mcg_per_l, 
                  f_Cr_mcg_per_l, f_Cu_mcg_per_l, f_Dy_mcg_per_l, f_La_mcg_per_l, f_Nd_mcg_per_l, 
                  `f_Pb Sum_mcg_per_l`, f_Pr_mcg_per_l, f_Se_mcg_per_l, f_Th_mcg_per_l, f_Tl_mcg_per_l, 
                  f_U_mcg_per_l, f_V_mcg_per_l), 
                ~ ifelse(. < 0, NA, .))) %>%
  mutate(
    Al = f_Al_mcg_per_l / f_SO4_mg_per_l,
    Fe = f_Fe_mcg_per_l / f_SO4_mg_per_l,
    Mn = f_Mn_mcg_per_l / f_SO4_mg_per_l,
    Co = f_Co_mcg_per_l / f_SO4_mg_per_l,
    Ni = f_Ni_mcg_per_l / f_SO4_mg_per_l,
    Zn = f_Zn_mcg_per_l / f_SO4_mg_per_l,
    As = f_As_mcg_per_l / f_SO4_mg_per_l,
    Ba = f_Ba_mcg_per_l / f_SO4_mg_per_l,
    Be = f_Be_mcg_per_l / f_SO4_mg_per_l,
    Cd = f_Cd_mcg_per_l / f_SO4_mg_per_l,
    Ce = f_Ce_mcg_per_l / f_SO4_mg_per_l,
    Cr = f_Cr_mcg_per_l / f_SO4_mg_per_l,
    Cu = f_Cu_mcg_per_l / f_SO4_mg_per_l,
    Dy = f_Dy_mcg_per_l / f_SO4_mg_per_l,
    La = f_La_mcg_per_l / f_SO4_mg_per_l,
    Nd = f_Nd_mcg_per_l / f_SO4_mg_per_l,
    Pb_Sum = `f_Pb Sum_mcg_per_l` / f_SO4_mg_per_l,
    Pr = f_Pr_mcg_per_l / f_SO4_mg_per_l,
    Se = f_Se_mcg_per_l / f_SO4_mg_per_l,
    Th = f_Th_mcg_per_l / f_SO4_mg_per_l,
    Tl = f_Tl_mcg_per_l / f_SO4_mg_per_l,
    U = f_U_mcg_per_l / f_SO4_mg_per_l,
    V = f_V_mcg_per_l / f_SO4_mg_per_l
  )
```

```{r}
seep_data <- seep_data %>%
  mutate(
    sum_of_f_metals = rowSums(dplyr::select(., Fe, Mn, Co, Ni, Zn, As, Al, Ba, Be, Cd, Ce, Cr, Cu, Dy, La, Nd, Pb_Sum, Pr, Se, Th, Tl, U, V), na.rm = TRUE) 
  ) %>%
  mutate(across(c(Fe, Mn, Co, Ni, Zn, As, Al, Ba, Be, Cd, Ce, Cr, Cu, Dy, La, Nd, Pb_Sum, Pr, Se, Th, Tl, U, V), 
                ~ (. / sum_of_f_metals) * 100, 
                .names = "percent_{.col}"))
```

```{r}
seep_long_conc <- seep_data %>%
  dplyr::select(Watershed, `Field label`, SamplingEventID, Al, Fe, Mn, Co, Ni, Zn, As, Ba, Be, Cd, Ce, Cr, Cu, Dy, La, Nd, Pb_Sum, Pr, Se, Th, Tl, U, V
) %>%
  pivot_longer(
    cols = c(Al, Fe, Mn, Co, Ni, Zn, As, Ba, Be, Cd, Ce, Cr, Cu, Dy, La, Nd, Pb_Sum, Pr, Se, Th, Tl, U, V), 
    names_to = "Metal", 
    values_to = "Concentration"
  ) %>%
  mutate(Concentration = ifelse(Concentration < 0, NA, Concentration))

view(seep_long_conc)
```

```{r}
seep_long_percent <- seep_data %>%
  dplyr::select(Watershed, `Field label`, SamplingEventID, percent_Al, percent_Fe, percent_Mn, percent_Co, percent_Ni, percent_Zn, percent_As, percent_Ba, percent_Be, 
percent_Cd, percent_Ce, percent_Cr, percent_Cu, percent_Dy, percent_La, percent_Nd, 
percent_Pb_Sum, percent_Pr, percent_Se, percent_Th, percent_Tl, percent_U, percent_V
) %>%
  pivot_longer(
    cols = c(percent_Al, percent_Fe, percent_Mn, percent_Co, percent_Ni, percent_Zn, percent_As, percent_Ba, percent_Be, 
percent_Cd, percent_Ce, percent_Cr, percent_Cu, percent_Dy, percent_La, percent_Nd, 
percent_Pb_Sum, percent_Pr, percent_Se, percent_Th, percent_Tl, percent_U, percent_V), 
    names_to = "Metal", 
    values_to = "Percent"
  ) %>%
  mutate(Percent = ifelse(Percent < 0, NA, Percent))


view(seep_long_percent)

```

```{r}
seep_concentration <- seep_long_conc %>%
  filter(SamplingEventID %in% c("ANF_Tseep_20230607_1500",
                              "TukC_seep1_20230716_1422",
                              "NakC_seep_1_20230830_1305",
                              "TukC_Trib2_source_20230716_1101",
                              "TukC_seep_con_20230716_1628")) %>%
  ggplot(aes(x = SamplingEventID, y = Concentration, fill = Metal)) +
  geom_bar(stat = "identity", position = "stack") +  # Stacked bars
  labs(
    title = "Stacked Bar Chart of Metal Concentrations",
    x = "Site Group",
    y = "Concentration (mcg/L)",
    fill = "Metal"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels if needed
    legend.position = "right"
  )

seep_concentration

```

## I think this is a decent way to visualize this
need to remake it once I have the metal data more finalized, right now the Aggie seep doesn't have an f_Fe concentration which is not correct
```{r}
percent_metal_colors <- c(
  "percent_Al" = "#8B0000",   # Dark Red
  "percent_Mn" = "#1f77b4",   # Blue
  "percent_Fe" = "#ff7f0e",   # Orange
  "percent_Co" = "#2ca02c",   # Green
  "percent_Ni" = "#d62728",   # Red
  "percent_Zn" = "#9467bd",   # Purple
  "percent_As" = "#8c564b",   # Brown
  "percent_Ba" = "#e377c2",   # Pink
  "percent_Be" = "#7f7f7f",   # Gray
  "percent_Cd" = "#bcbd22",   # Yellow-Green
  "percent_Ce" = "#17becf",   # Cyan
  "percent_Cr" = "#aec7e8",   # Light Blue
  "percent_Cu" = "#ffbb78",   # Light Orange
  "percent_Dy" = "#98df8a",   # Light Green
  "percent_La" = "#ff9896",   # Light Red
  "percent_Nd" = "#c5b0d5",   # Light Purple
  "percent_Pb_Sum" = "#c49c94", # Light Brown
  "percent_Pr" = "#f7b6d2",   # Light Pink
  "percent_Se" = "#c7c7c7",   # Light Gray
  "percent_Th" = "#dbdb8d",   # Pale Yellow-Green
  "percent_Tl" = "#9edae5",   # Pale Cyan
  "percent_U" = "#393b79",    # Dark Blue
  "percent_V" = "#637939"     # Dark Green
)



```

```{r}
seep_percent <- seep_long_percent %>%
  filter(SamplingEventID %in% c("ANF_Tseep_20230607_1500",
                              "TukC_seep1_20230716_1422",
                              "NakC_seep_1_20230830_1305",
                              "TukC_Trib2_source_20230716_1101",
                              "TukC_seep_con_20230716_1628")) %>%
  ggplot(aes(x = SamplingEventID, y = Percent, fill = Metal)) +
  geom_bar(stat = "identity") + 
  labs(
    title = "Stacked Bar Chart of Metal Concentrations",
    x = "Site Group",
    y = "Percent",
    fill = "Metal"
  ) +
  scale_fill_manual(values = percent_metal_colors) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels if needed
    legend.position = "right"
  )

seep_percent
```

```{r}
library(ggplot2)

Aggie_pie <- seep_long %>%
  filter(SamplingEventID %in% c("ANF_Tseep_20230607_1500")) %>%
  ggplot(aes(x = "", y = Concentration, fill = Metal)) +
  geom_bar(stat = "identity", width = 1) +  # Creates bar chart first
  coord_polar("y", start = 0) +  # Converts to pie chart
  theme_void() +  # Removes axes for a clean look
  labs(title = "Metal Concentration Distribution") +
  theme(legend.position = "right")  # Adjust legend placement

Aggie_pie

```


```{r}
library(ggplot2)

ggplot()

```
